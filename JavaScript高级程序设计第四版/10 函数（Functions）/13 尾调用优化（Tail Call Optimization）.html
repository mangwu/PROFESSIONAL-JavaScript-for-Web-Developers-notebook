<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>13. å°¾è°ƒç”¨ä¼˜åŒ–ï¼ˆTail Call Optimizationï¼‰</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style><link rel="stylesheet" href="../../style.css"></head><body><article id="e1adb2ab-032a-43ea-9cf7-e364cb8c6e55" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/met_henri_rousseau_1907.jpg" style="object-position:center 30.000000000000004%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">ğŸ´</span></div><h1 class="page-title">13. å°¾è°ƒç”¨ä¼˜åŒ–ï¼ˆTail Call Optimizationï¼‰</h1></header><div class="page-body"><div id="46d22dce-e253-46ab-b2fc-45c9f9039978" class="column-list"><div id="bc521ca1-ed5e-42f7-9e47-0b75cc5f8435" style="width:12.5%" class="column"><nav id="ebdf25d8-d12c-4127-a7bb-e981fa606432" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#19d40c88-e4ff-4d8a-8bb8-8b445b8a4773">13.1 å°¾è°ƒç”¨ä¼˜åŒ–</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e9013002-3c7f-415e-9bbe-71f12bdad0b4">13.1.1 å°¾è°ƒç”¨(tail call)</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#aefc9b8d-a2e2-44eb-9000-1a362d213cd7">13.1.2 å†…å­˜ç®¡ç†ä¼˜åŒ–æœºåˆ¶</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#60d5f149-c689-4909-a156-d6350bbd4a88">13.2 å°¾è°ƒç”¨ä¼˜åŒ–çš„æ¡ä»¶ï¼ˆTail Call Optimization Requirementsï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#609e6300-487b-48d5-aee7-78ddb9ed9188">13.3 å°¾è°ƒç”¨ä¼˜åŒ–çš„ä»£ç ï¼ˆCoding for Tail Call Optimizationï¼‰</a></div></nav><p id="db00b334-67da-4969-8df3-7af75fafd856" class="">
</p></div><div id="74699b93-e4c5-4153-ad91-910b10fe2417" style="width:87.5%" class="column"><h1 id="19d40c88-e4ff-4d8a-8bb8-8b445b8a4773" class="">13.1 å°¾è°ƒç”¨ä¼˜åŒ–</h1><h2 id="e9013002-3c7f-415e-9bbe-71f12bdad0b4" class="">13.1.1 å°¾è°ƒç”¨(tail call)</h2><ul id="23f02ad9-4019-4614-83fa-ab0e6c41d070" class="bulleted-list"><li style="list-style-type:disc"><strong>å°¾è°ƒç”¨</strong>ï¼ˆ<strong>tail call</strong>ï¼‰æŒ‡åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå…¶<strong>è¿”å›å€¼ä¸ºè°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼</strong>ï¼Œå³å¤–éƒ¨å‡½æ•°ï¼ˆ<strong>outer function</strong>ï¼‰çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼ˆ<strong>inner function</strong>ï¼‰çš„è¿”å›å€¼</li></ul><ul id="a95f73cf-d0a0-4f29-ba70-b938cdb7169c" class="bulleted-list"><li style="list-style-type:disc">ä¾‹å¦‚<pre id="d6e3ee28-cad0-4260-b14f-76e55d60ab7d" class="code code-wrap"><code>function innerFunction() {
  return &quot;å°¾è°ƒç”¨&quot;;
}

// å°¾è°ƒç”¨
function outerFunction() {
  return innerFunction(); // å°¾è°ƒç”¨
}</code></pre></li></ul><h2 id="aefc9b8d-a2e2-44eb-9000-1a362d213cd7" class="">13.1.2 å†…å­˜ç®¡ç†ä¼˜åŒ–æœºåˆ¶</h2><ul id="4385c816-5958-4f4a-b9ce-8b34ea7cf245" class="bulleted-list"><li style="list-style-type:disc">ES6æ–°å¢äº†ä¸€é¡¹<strong>å†…å­˜ç®¡ç†ä¼˜åŒ–æœºåˆ¶</strong>ï¼ˆ<strong>memory management optimization</strong>ï¼‰ï¼Œè®©JavaScriptå¼•æ“åœ¨æ»¡è¶³æ¡ä»¶æ—¶å¯ä»¥<strong>é‡ç”¨æ ˆå¸§</strong>ï¼ˆ<strong>reuse stack frames</strong>ï¼‰</li></ul><ul id="df3d6612-8076-4496-be67-079c4d7003f6" class="bulleted-list"><li style="list-style-type:disc">è¿™é¡¹ä¼˜åŒ–éå¸¸é€‚åˆå°¾è°ƒç”¨</li></ul><hr id="033eb38f-03a6-4282-a04a-e6545f4e860f"/><ul id="c22940e2-1bd7-46f4-814b-25c3b1890a6d" class="bulleted-list"><li style="list-style-type:disc">åœ¨ES6ä¼˜åŒ–ä¹‹å‰ï¼ˆä¸ä½¿ç”¨å†…å­˜ç®¡ç†ä¼˜åŒ–æœºåˆ¶ï¼‰ï¼Œå°¾è°ƒç”¨ï¼ˆä»¥ä¸Šé¢çš„å°¾è°ƒç”¨ä¾‹å­ä¸¾ä¾‹ï¼‰ä¼šåœ¨å†…å­˜ä¸­å‘ç”Ÿå¦‚ä¸‹æ“ä½œ<ol type="1" id="a7249f92-4844-474a-ae8f-3b9d597ecb69" class="numbered-list" start="1"><li><strong>æ‰§è¡Œåˆ°</strong>(<strong>execution reach</strong>)<code>outerFunction</code> å‡½æ•°ä½“ï¼Œç¬¬ä¸€ä¸ª<strong>æ ˆå¸§</strong>(<strong>stack frame</strong>)è¢«<strong>æ¨åˆ°</strong>ï¼ˆ<strong>push onto</strong>ï¼‰æ ˆä¸Š</li></ol><ol type="1" id="49a3c63b-c2ba-41df-8f96-33c5aeb4e2e7" class="numbered-list" start="2"><li><strong>æ‰§è¡Œ</strong>ï¼ˆ<strong>execute</strong>ï¼‰<code>outerFunction</code> å‡½æ•°ä½“ï¼Œ<strong>åˆ°</strong>(<strong>reach</strong>)<code>return</code>è¯­å¥ï¼Œ<strong>è®¡ç®—</strong>ï¼ˆ<strong>evaluate</strong>ï¼‰è¿”å›å€¼å¿…é¡»å…ˆè®¡ç®—<code>innerFunction()</code> </li></ol><ol type="1" id="57956751-c85d-4e66-95ce-34b29a9f38bc" class="numbered-list" start="3"><li><strong>æ‰§è¡Œåˆ°</strong>(<strong>execution reach</strong>)<code>innerFunction</code> å‡½æ•°ä½“ï¼Œç¬¬äºŒä¸ª<strong>æ ˆå¸§</strong>(<strong>stack frame</strong>)è¢«<strong>æ¨åˆ°</strong>ï¼ˆ<strong>push onto</strong>ï¼‰æ ˆä¸Š</li></ol><ol type="1" id="c4a53e16-ec2e-4128-8ce1-7e04c6186404" class="numbered-list" start="4"><li><strong>æ‰§è¡Œ</strong>ï¼ˆ<strong>execute</strong>ï¼‰<code>innerFunction</code> å‡½æ•°ä½“ï¼Œ<strong>è®¡ç®—</strong>ï¼ˆ<strong>evaluate</strong>ï¼‰å…¶è¿”å›å€¼</li></ol><ol type="1" id="76271da2-c521-4de9-af42-01db747d4b19" class="numbered-list" start="5"><li>å°†è¿”å›å€¼<strong>ä¼ å›</strong>(<strong>pass back</strong>)<code>outerFunction</code> ,ç„¶å</li></ol><ol type="1" id="fcef9d43-8ad4-4d8c-8ef6-d6b082017e7e" class="numbered-list" start="6"><li>å°†<strong>æ ˆå¸§</strong>ï¼ˆ<strong>stack frames</strong>ï¼‰<strong>å¼¹å‡º</strong>ï¼ˆ<strong>poped off</strong>ï¼‰æ ˆï¼ˆæ³¨æ„è¿™é‡Œæ ˆå¸§æ˜¯å¤æ•°ï¼‰</li></ol></li></ul><ul id="f5225d81-ccc2-431f-bd8e-e1041b9559c2" class="bulleted-list"><li style="list-style-type:disc">åœ¨ES6ä¼˜åŒ–ä¹‹åï¼ˆä½¿ç”¨å†…å­˜ç®¡ç†ä¼˜åŒ–æœºåˆ¶ï¼‰ï¼Œå°¾è°ƒç”¨ï¼ˆä»¥ä¸Šé¢çš„å°¾è°ƒç”¨ä¾‹å­ä¸¾ä¾‹ï¼‰ä¼šåœ¨å†…å­˜ä¸­å‘ç”Ÿå¦‚ä¸‹æ“ä½œ<ol type="1" id="9d3adfc3-6a74-4fad-8a24-f5d2adae7fba" class="numbered-list" start="1"><li><strong>æ‰§è¡Œåˆ°</strong>(<strong>execution reach</strong>)<code>outerFunction</code> å‡½æ•°ä½“ï¼Œç¬¬ä¸€ä¸ª<strong>æ ˆå¸§</strong>(<strong>stack frame</strong>)è¢«<strong>æ¨åˆ°</strong>ï¼ˆ<strong>push onto</strong>ï¼‰æ ˆä¸Š</li></ol><ol type="1" id="7d7e116d-4fab-4a04-bb20-3ad55ad3639e" class="numbered-list" start="2"><li><strong>æ‰§è¡Œ</strong>ï¼ˆ<strong>execute</strong>ï¼‰<code>outerFunction</code> å‡½æ•°ä½“ï¼Œ<strong>åˆ°</strong>(<strong>reach</strong>)<code>return</code>è¯­å¥ï¼Œ<strong>è®¡ç®—</strong>ï¼ˆ<strong>evaluate</strong>ï¼‰è¿”å›å€¼å¿…é¡»å…ˆè®¡ç®—<code>innerFunction()</code> </li></ol><ol type="1" id="90396161-4c10-48ee-b4bd-1286bec435fb" class="numbered-list" start="3"><li>å¼•æ“å‘ç°èƒ½æŠŠç¬¬ä¸€ä¸ª<strong>æ ˆå¸§</strong>ï¼ˆ<strong>stack frame</strong>ï¼‰<strong>å®‰å…¨</strong>ï¼ˆ<strong>safely</strong>ï¼‰<strong>å¼¹å‡º</strong>ï¼ˆ<strong>pop off</strong>ï¼‰æ ˆï¼Œå› ä¸º<code>innerFunction</code></li></ol><ol type="1" id="c803b31d-4252-4891-9c39-060fffe74f27" class="numbered-list" start="4"><li><strong>å¼¹å‡º</strong>ï¼ˆ<strong>pop off</strong>ï¼‰<code>outerFunction</code> çš„<strong>å¸§æ ˆ</strong>ï¼ˆ<strong>stack frame</strong>ï¼‰</li></ol><ol type="1" id="04963fe0-eae1-41dc-93e0-41651eff12e7" class="numbered-list" start="5"><li><strong>æ‰§è¡Œåˆ°</strong>(<strong>execution reach</strong>)<code>innerFunction</code> å‡½æ•°ä½“ï¼Œ<strong>æ ˆå¸§</strong>(<strong>stack frame</strong>)è¢«<strong>æ¨åˆ°</strong>ï¼ˆ<strong>push onto</strong>ï¼‰æ ˆä¸Š</li></ol><ol type="1" id="5304fce9-d82f-48a6-86d0-e9d2659b2414" class="numbered-list" start="6"><li><strong>æ‰§è¡Œ</strong>ï¼ˆ<strong>execute</strong>ï¼‰<code>innerFunction</code> å‡½æ•°ä½“ï¼Œ<strong>è®¡ç®—</strong>ï¼ˆ<strong>evaluate</strong>ï¼‰å…¶è¿”å›å€¼</li></ol><ol type="1" id="028ecc22-e3d8-4793-9477-6683b6e5f1dc" class="numbered-list" start="7"><li><strong>å¼¹å‡º</strong>ï¼ˆ<strong>pop off</strong>ï¼‰<code>innerFunction</code> çš„<strong>å¸§æ ˆ</strong>ï¼ˆ<strong>stack frame</strong>ï¼‰</li></ol></li></ul><hr id="53f18a86-793b-4298-8ecd-0dff0aae01df"/><ul id="7fb7010a-dbf4-4076-aafa-5843c9a926df" class="bulleted-list"><li style="list-style-type:disc">å¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€ç§æƒ…å†µä¸‹æ¯å¤šè°ƒç”¨ä¸€æ¬¡<strong>åµŒå¥—å‡½æ•°</strong>ï¼ˆ<strong>nested function</strong>ï¼‰ï¼Œå°±ä¼šå¤šå¢åŠ ä¸€ä¸ªå¸§æ ˆçš„æˆæœ¬</li></ul><ul id="02a462a0-d7ff-43df-975a-67fb3409da0a" class="bulleted-list"><li style="list-style-type:disc">è€Œç¬¬äºŒç§æƒ…å†µä¸‹æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡åµŒå¥—å‡½æ•°ï¼Œæ•´ä¸ª<strong>æ‰§è¡Œå‘¨æœŸ</strong>ï¼ˆ<strong>length of execution</strong>ï¼‰éƒ½åªå ç”¨ä¸€ä¸ªå¸§æ ˆçš„æˆæœ¬</li></ul><ul id="525b1553-76ec-4dcc-9553-cc251cb134f7" class="bulleted-list"><li style="list-style-type:disc">è¿™å°±æ˜¯ES6å°¾è°ƒç”¨ä¼˜åŒ–çš„å…³é”®ï¼šå¦‚æœä»¥ä¸€ç§æ–¹å¼è¢«æ„é€ çš„å‡½æ•°ï¼ˆfunction is structured in a wayï¼‰å…è®¸<strong>åŸºäºå°¾è°ƒç”¨</strong>ï¼ˆ<strong>upon the tail call</strong>ï¼‰è¢«<strong>å®‰å…¨çš„é”€æ¯</strong>ï¼ˆ<strong>safely discarded</strong>ï¼‰ï¼Œåˆ™å¼•æ“å°±ä¼šè¿™ä¹ˆåš<ul id="7fb08d5e-e666-4dcd-a5bb-8fcf0c4d1974" class="bulleted-list"><li style="list-style-type:circle">è¿™å¥è¯çš„æ„æ€å°±æ˜¯å†…å­˜ç®¡ç†ä¼˜åŒ–åï¼Œå¦‚æœé‡åˆ°å°¾è°ƒç”¨ï¼Œå¯ä»¥<strong>æå‰å°†å¤–éƒ¨å‡½æ•°çš„æ ˆå¸§å‡ºæ ˆ</strong>ï¼ˆç›¸å½“äºé”€æ¯ï¼‰ï¼Œç›´æ¥è°ƒç”¨å†…éƒ¨å‡½æ•°</li></ul></li></ul><figure class="block-color-red_background callout" style="white-space:pre-wrap;display:flex" id="791a39ce-9c5c-4c71-8b13-61e1d7f4cdc5"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%"><strong>æ³¨æ„</strong>ï¼šç°åœ¨æ²¡æœ‰åŠæ³•æµ‹è¯•å°¾è°ƒç”¨ä¼˜åŒ–æ˜¯å¦<strong>æœ‰ä½œç”¨</strong>ï¼ˆ<strong>occurring</strong>ï¼‰ã€‚ä¸è¿‡ï¼Œå› ä¸ºè¿™æ˜¯ES6è§„èŒƒæ‰€è§„å®šï¼Œ<strong>å…¼å®¹çš„</strong>ï¼ˆ<strong>compliant</strong>ï¼‰æµè§ˆå™¨å®ç°éƒ½èƒ½ä¿è¯åœ¨ä»£ç æ»¡è¶³æ¡ä»¶ï¼ˆ<strong>requirements</strong>ï¼‰çš„æƒ…å†µä¸‹åº”ç”¨è¿™ä¸ªä¼˜åŒ–<p id="bbb27651-f031-48da-8ddb-e5a936e46725" class=""><mark class="highlight-gray">ç†è®ºä¸Šï¼Œå‡è®¾æœ‰nä¸ªåµŒå¥—çš„å°¾è°ƒç”¨ï¼Œé‚£ä¹ˆä¸ä½¿ç”¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œç©ºé—´å¤æ‚åº¦ä¸»è¦æ˜¯æ ˆçš„é•¿åº¦ï¼Œå³O(n)ï¼Œä½¿ç”¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå› ä¸ºæ•´ä¸ªæ‰§è¡Œå‘¨æœŸåªå ç”¨ä¸€ä¸ªæ ˆå¸§æˆæœ¬ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦åªæœ‰O(1)</mark></p></div></figure><h1 id="60d5f149-c689-4909-a156-d6350bbd4a88" class="">13.2 å°¾è°ƒç”¨ä¼˜åŒ–çš„æ¡ä»¶ï¼ˆTail Call Optimization Requirementsï¼‰</h1><ul id="7f1094cf-f836-4071-b4a8-e2b432b2f646" class="bulleted-list"><li style="list-style-type:disc">æ˜ç¡®å‡ ä¸ªæ¦‚å¿µ<ul id="be36acc2-77c5-4ebd-95fe-7cad4891c702" class="bulleted-list"><li style="list-style-type:circle"><strong>å¤–éƒ¨å‡½æ•°ï¼ˆouter functionï¼‰</strong>ï¼Œè¿”å›å€¼ä¸ºè°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼çš„å‡½æ•°</li></ul><ul id="9712fba1-b861-4b2c-aea8-edeefe4ac2aa" class="bulleted-list"><li style="list-style-type:circle"><strong>å°¾è°ƒç”¨å‡½æ•°ï¼ˆtail call functionï¼‰ï¼Œ</strong>å°±æ˜¯å°¾è°ƒç”¨ä¸­çš„å†…éƒ¨å‡½æ•°ï¼Œæ˜¯å¤–éƒ¨å‡½æ•°ä½“çš„è¿”å›è¯­å¥ä¸­è¢«è°ƒç”¨çš„å‡½æ•°</li></ul><ul id="8a65e663-349a-4b4b-bd8f-12ab45643dc8" class="bulleted-list"><li style="list-style-type:circle"><strong>å¤–éƒ¨æ ˆå¸§</strong>ï¼ˆ<strong>outer stack frame</strong>ï¼‰ï¼Œæ‰§è¡Œåˆ°å¤–éƒ¨å‡½æ•°æ¨åˆ°æ ˆä¸Šçš„æ ˆå¸§</li></ul></li></ul><ul id="cfa6b8cc-ac84-409a-aff8-655ff3bfe2e1" class="bulleted-list"><li style="list-style-type:disc">å°¾è°ƒç”¨ä¼˜åŒ–çš„æ¡ä»¶å°±æ˜¯ç¡®å®š<strong>å¤–éƒ¨æ ˆå¸§</strong>ï¼ˆ<strong>outer stack frame</strong>ï¼‰çœŸçš„æ²¡æœ‰å¿…è¦å­˜åœ¨äº†ï¼Œæ¯å¿…è¦å­˜åœ¨çš„æ¡ä»¶å¦‚ä¸‹<ul id="473a80bc-aac0-44b2-9d54-83628d5d5751" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">ä»£ç åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ‰§è¡Œ</span></li></ul><ul id="92801a50-500a-4124-8a87-4aa62b88c833" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">å¤–éƒ¨å‡½æ•°çš„è¿”å›å€¼æ˜¯å¯¹<strong>å°¾è°ƒç”¨å‡½æ•°</strong>ï¼ˆ<strong>tail call function</strong>ï¼‰çš„è°ƒç”¨</span></li></ul><ul id="83267791-7527-40d1-b3c1-2ee55eb0f65a" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">å°¾è°ƒç”¨å‡½æ•°è¿”å›åæ²¡æœ‰<strong>é¢å¤–æ‰§è¡Œå‘½ä»¤</strong>ï¼ˆ<strong>no further execution</strong>ï¼‰</span></li></ul><ul id="a1a19d87-2d53-485e-9686-8ded030869ad" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">å°¾è°ƒç”¨å‡½æ•°ä¸æ˜¯<strong>å¼•ç”¨</strong>ï¼ˆ<strong>refer to</strong>ï¼‰<strong>å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸ</strong>ï¼ˆ<strong>outer functionâ€™s scope</strong>ï¼‰ä¸­è‡ªæœ‰å˜é‡çš„<strong>é—­åŒ…</strong>ï¼ˆ<strong>closure</strong>ï¼‰</span></li></ul><figure class="block-color-red_background callout" style="white-space:pre-wrap;display:flex" id="9a363447-4901-4e49-9d5a-45f8b46d907a"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">æ³¨æ„ï¼šä¹‹æ‰€ä»¥è¦æ±‚ä¸¥æ ¼æ¨¡å¼ï¼Œä¸»è¦å› ä¸ºåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹å‡½æ•°è°ƒç”¨å…è®¸ä½¿ç”¨<code>f.arguments</code> å’Œ<code>f.caller</code> ï¼Œè€Œå®ƒä»¬éƒ½ä¼šå¼•ç”¨å¤–éƒ¨å‡½æ•°çš„æ ˆå¸§ï¼Œè€Œå®ƒä»¬éƒ½ä¼šå¼•ç”¨å¤–éƒ¨å‡½æ•°çš„æ ˆå¸§ï¼ˆ<code>f.caller</code> å¼•ç”¨çš„å°±æ˜¯å¤–éƒ¨å‡½æ•°ï¼Œè€Œ<code>f.arguments</code> çš„å±æ€§<code>f.arguments.callee.caller</code> ä¼šé—´æ¥å¼•ç”¨å¤–éƒ¨å‡½æ•°ï¼‰ï¼›æ˜¾ç„¶ï¼Œè¿™æ„å‘³ç€ä¸èƒ½åº”ç”¨ä¼˜åŒ–äº†ï¼ˆä¸èƒ½æå‰é”€æ¯å¤–éƒ¨å‡½æ•°çš„æ ˆå¸§ï¼‰ï¼Œå› æ­¤å°¾è°ƒç”¨ä¼˜åŒ–å¿…é¡»è¦æ±‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æœ‰æ•ˆï¼Œé˜²æ­¢å¼•ç”¨è¿™äº›å±æ€§</div></figure></li></ul><ul id="9e660847-40d9-4b30-9f23-3015a66b83fb" class="bulleted-list"><li style="list-style-type:disc">ä¸€äº›è¿åä¸Šè¿°æ¡ä»¶çš„ä¾‹å­<pre id="c7fc15c7-2dac-4397-b19b-507c1e7de1ac" class="code code-wrap"><code>// åœ¨å¤–éƒ¨å‡½æ•°ä¸­è°ƒç”¨çš„å†…éƒ¨å‡½æ•°
function innerFunction() {
  &quot;use strict&quot;;
  return 4396;
}

// ä»¥ä¸‹æ˜¯ä¸ä¸æ»¡è¶³æ¡ä»¶çš„ä¾‹å­
function outerFunction() {
  // æ— å°¾è°ƒç”¨ä¼˜åŒ–ï¼šä¸æ˜¯ä¸¥æ ¼æ¨¡å¼
  return innerFunction();
}

function outerFunction() {
  // æ— å°¾è°ƒç”¨ä¼˜åŒ–ï¼šå°¾è°ƒç”¨æ²¡æœ‰è¿”å›
  &quot;use strict&quot;;
  innerFunction();
}

function outerFunction() {
  // æ— å°¾è°ƒç”¨ä¼˜åŒ–ï¼šå°¾è°ƒç”¨æ²¡æœ‰ç›´æ¥è¿”å›
  &quot;use strict&quot;;
  const res = innerFunction();
  return res;
}

function outerFunction() {
  // æ— å°¾è°ƒç”¨ä¼˜åŒ–ï¼šå°¾è°ƒç”¨å‡½æ•°è¿”å›åä¸éœ€è¦æ‰§è¡Œé¢å¤–çš„é€»è¾‘
  &quot;use strict&quot;;
  return innerFunction().toString();
}

function outerFunction() {
  // æ— å°¾è°ƒç”¨ä¼˜åŒ–ï¼šå°¾è°ƒç”¨å‡½æ•°è¿”ä¸èƒ½å¼•ç”¨å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸä¸­çš„é—­åŒ…
  &quot;use strict&quot;;
  let foo = &quot;bar&quot;;
  function innerFunction() {
    return foo;
  }
  return innerFunction();
}</code></pre></li></ul><ul id="dd0549a9-3068-4f58-89d5-739a0d8f77c9" class="bulleted-list"><li style="list-style-type:disc">ä¸€äº›ç¬¦åˆæ¡ä»¶çš„ä¾‹å­<pre id="b2ff6aa3-f299-4bc5-ab5e-56bb52db5e84" class="code code-wrap"><code>// ç¬¦åˆæ¡å°¾è°ƒç”¨ä¼˜åŒ–æ¡ä»¶çš„ä¾‹å­
function outerFunction(a, b) {
  // æœ‰å°¾è°ƒç”¨ä¼˜åŒ–ï¼šå¸§æ ˆé”€æ¯å‰æ‰§è¡Œå‚æ•°è®¡ç®—
  &quot;use strict&quot;;
  return innerFunction(a + b);
}

function outerFunction(a, b) {
  // æœ‰å°¾è°ƒç”¨ä¼˜åŒ–ï¼šåˆå§‹è¿”å›å€¼ä¸æ¶‰åŠæ ˆå¸§
  &quot;use strict&quot;;
  if (a &lt; b) {
    return a;
  }
  return innerFunction(a + b);
}

function outerFunction(a, b) {
  // æœ‰å°¾è°ƒç”¨ä¼˜åŒ–ï¼šä¸¤ä¸ªå°¾è°ƒç”¨å‡½æ•°éƒ½åœ¨å°¾éƒ¨ä¸”æ²¡æœ‰é¢å¤–çš„é€»è¾‘æ‰§è¡Œ
  &quot;use strict&quot;;
  return a &gt; b ? innerFunction(a) : innerFunction(b); // è¿™ä¸¤ä¸ªå°¾è°ƒç”¨å‡½æ•°å¯ä»¥ä¸æ˜¯åŒä¸€ä¸ªå‡½æ•°å¯¹è±¡
}</code></pre><ul id="258f7c32-17d4-4ee5-8ade-fd0273ebd389" class="bulleted-list"><li style="list-style-type:circle">è¿™ä¸‰ä¸ªç¬¦åˆæ¡ä»¶çš„å°¾è°ƒç”¨ä¾‹å­ä¸­ï¼Œæœ€åä¸€ä¸ªå±äº<strong>å·®å¼‚åŒ–å°¾è°ƒç”¨</strong>ï¼ˆ<strong>differentiating tail calls</strong>ï¼‰ï¼Œå³æ ¹æ®æ¡ä»¶ä¸åŒï¼Œå°¾è°ƒç”¨çš„å‡½æ•°å‚æ•°ä¸åŒæˆ–å°¾è°ƒç”¨å‡½æ•°ä¸åŒ</li></ul></li></ul><hr id="d1002cbb-ddc3-47d4-be13-c7afe8757657"/><ul id="fd7c6fc4-a3be-489c-843c-f3f41b963253" class="bulleted-list"><li style="list-style-type:disc">å®é™…ä¸Šï¼Œ<strong>é€’å½’è°ƒç”¨ï¼ˆrecursive calï¼‰åœ¨ç¬¦åˆæ¡ä»¶çš„æƒ…å†µä¸‹ä¹Ÿå±äºå°¾è°ƒç”¨</strong>ï¼Œå·®å¼‚åŒ–å°¾è°ƒç”¨å’Œé€’å½’è°ƒç”¨æ˜¯å®¹æ˜“è®©äººæ„Ÿåˆ°<strong>å›°æƒ‘çš„</strong>ï¼ˆ<strong>confusion</strong>ï¼‰ï¼›ä½†éœ€è¦æ³¨æ„åˆ°çš„æ˜¯ï¼šæ— è®ºæ˜¯é€’å½’è°ƒç”¨è¿˜æ˜¯éé€’å½’è°ƒç”¨ï¼Œåœ¨æ»¡è¶³å°¾è°ƒç”¨æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥åº”ç”¨ä¼˜åŒ–ï¼Œå¼•æ“å¹¶ä¸åŒºåˆ†å°¾è°ƒç”¨ä¸­è°ƒç”¨çš„å‡½æ•°æ˜¯å‡½æ•°è‡ªèº«è¿˜æ˜¯å…¶å®ƒå‡½æ•°</li></ul><ul id="b6af13f6-ad55-49c3-a142-2997bdfe56ff" class="bulleted-list"><li style="list-style-type:disc">é€’å½’åœºæ™¯ä¸‹ï¼Œå°¾è°ƒç”¨ä¼˜åŒ–çš„æ•ˆæœæ˜¯æœ€<strong>æ˜æ˜¾</strong>çš„ï¼Œå› ä¸ºä¸€èˆ¬å‡½æ•°å°¾è°ƒç”¨åµŒå¥—ä¸äº†å¤šå°‘å±‚ï¼Œè€Œé€’å½’ä»£ç æœ€å®¹æ˜“åœ¨æ ˆå†…å­˜ä¸­è¿…é€Ÿäº§ç”Ÿå¤§é‡æ ˆå¸§ï¼›ä½†æ˜¯å¤§å¤šæ•°é€’å½’å‡½æ•°å¹¶ä¸æ˜¯ç®€å•çš„è°ƒç”¨å‡½æ•°æœ¬èº«ç„¶åè¿”å›ï¼Œæ›´å¤æ‚çš„ä¼šå¤šæ¬¡é€’å½’è°ƒç”¨æœ¬èº«ï¼Œæ‰€ä»¥ä¸‹ä¸€èŠ‚ä¼šä»‹ç»å°†ä¸ç¬¦åˆæ¡ä»¶çš„é€’å½’å‡½æ•°è½¬æ¢ä¸ºå¯ä»¥è¿›è¡Œå°¾è°ƒç”¨ä¼˜åŒ–çš„é€’å½’å‡½æ•°</li></ul><h1 id="609e6300-487b-48d5-aee7-78ddb9ed9188" class="">13.3 å°¾è°ƒç”¨ä¼˜åŒ–çš„ä»£ç ï¼ˆCoding for Tail Call Optimizationï¼‰</h1><ul id="8ffd1d2a-eae4-47f4-bdbf-8e1d4d4ab71c" class="bulleted-list"><li style="list-style-type:disc">å¯ä»¥é€šè¿‡æŠŠç®€å•çš„é€’å½’å‡½æ•°è½¬æ¢æˆå¾…ä¼˜åŒ–çš„ä»£ç ä»¥åŠ æ·±å¯¹å°¾è°ƒç”¨ä¼˜åŒ–çš„ç†è§£</li></ul><ul id="3d686284-34b8-41de-b120-87d6cfb385c2" class="bulleted-list"><li style="list-style-type:disc">æ–æ³¢é‚£å¥‘æ•°åˆ—å¯ä»¥ç”¨ä¸€ä¸ªå…¸å‹çš„é€’å½’å‡½æ•°å®ç°ï¼š<pre id="c6b2c856-bead-479f-a40a-0c9b9ee8e663" class="code code-wrap"><code>&quot;use strict&quot;;
// 0 1 1 2 3 5 ...
function fibonacci(n) {
  if (n &lt; 2) {
    return n;
  }
  return fibonacci(n - 1) + fibonacci(n - 2);
}</code></pre></li></ul><ul id="56138d39-33c3-4c12-ac82-0ecf54bd7398" class="bulleted-list"><li style="list-style-type:disc">æ˜¾ç„¶æ•´ä¸ªå‡½æ•°ä¸ç¬¦åˆå°¾è°ƒç”¨ä¼˜åŒ–çš„æ¡ä»¶ï¼Œå› ä¸ºè¿”å›è¯­å¥ä¸­æœ‰ç›¸åŠ çš„æ“ä½œï¼ˆéœ€è¦æ‰§è¡Œé¢å¤–çš„é€»è¾‘ï¼‰</li></ul><ul id="eaf3109d-560f-4090-ae0e-f8b40039f57a" class="bulleted-list"><li style="list-style-type:disc">åˆå› ä¸ºåœ¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éœ€è¦é€’å½’è°ƒç”¨ä¸¤æ¬¡<code>fibonacci()</code> å‡½æ•°ï¼Œæ‰€ä»¥<code>fibonacci(n)</code> éœ€è¦çš„æ ˆå¸§æ•°å†…å­˜ç©ºé—´å¤æ‚åº¦ä¸º<p id="6e03a460-d6e8-4378-9230-cbb96a26042b" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>ifÂ nÂ &lt;Â 2</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>ifÂ nÂ â‰¥Â 2</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">O(n) = \begin{cases} O(1), &amp; \text{if n &lt; 2} \\ O(2^{n-1} + 1) &amp; \text{if n â‰¥ 2} \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">ifÂ nÂ &lt;Â 2</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">ifÂ nÂ â‰¥Â 2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><span>ï»¿</span></span>.</p><ul id="2f7be2b0-f971-427a-b56c-0d930baa1d97" class="bulleted-list"><li style="list-style-type:circle">å› æ­¤æŒ‡æ•°çº§çš„ç©ºé—´å¤æ‚åº¦å¯¼è‡´å³ä½¿<code>n</code> åªæœ‰40è¿™ä¹ˆå¤§éƒ½ä¼šä½¿å¾—æµè§ˆå™¨æˆ–nodeéœ€è¦è€—è´¹è¾ƒé•¿çš„æ—¶é—´è¿›è¡Œè¿ç®—ï¼Œå¦‚ä¸‹</li></ul><pre id="6a79a93f-eabc-4f0a-af43-352fdbe7220d" class="code code-wrap"><code>// nodeç¯å¢ƒ
const date = new Date();
console.log(fibonacci(40)); // 102334155
console.log(Date.now() - date); // 1070   (ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œå¹³å‡ä¸º1000msï¼Œå› è®¾å¤‡ä¸åŒè€Œå¼‚)</code></pre></li></ul><ul id="bf7dff48-eb81-42b6-842e-1ad02bc9fafa" class="bulleted-list"><li style="list-style-type:disc">è§£å†³æ ˆå¸§æ•°ç©ºé—´å¤æ‚åº¦çš„é—®é¢˜æœ‰ä¸åŒçš„<strong>ç­–ç•¥</strong>ï¼ˆ<strong>techniques</strong>ï¼‰ï¼Œä¾‹å¦‚è®°å¿†åŒ–æˆ–æŠŠé€’å½’å†™æˆè¿­ä»£å¾ªç¯å½¢å¼<p id="15e94e12-1375-44a6-9852-c5c82fd2092d" class=""><strong>è®°å¿†åŒ–æ–¹æ³•</strong>ï¼Œä½¿ç”¨<code>Map</code> æ˜ å°„ä¿å­˜å·²ç»è®¡ç®—è¿‡çš„æ–æ³¢çº³å¥‘æ•°åˆ—ï¼Œé¿å…é‡å¤è¿ç®—</p><pre id="55c25032-a945-4449-bd17-8d6d6a2358aa" class="code code-wrap"><code>const hash = new Map([
  [1, 1],
  [0, 0],
]);
const fib = (n) =&gt; {
  if (n &lt; 2) {
    return n;
  }
  if (hash.has(n)) {
    return hash.get(n);
  }
  let pre1 = -1;
  let pre2 = -1;
  if (hash.has(n - 1)) {
    pre1 = hash.get(n - 1);
  }
  if (hash.has(n - 2)) {
    pre2 = hash.get(n - 2);
  }

  if (pre1 == -1) {
    pre1 = fib(n - 1);
  }
  if (pre2 == -1) {
    pre2 = fib(n - 2);
  }
  hash.set(n, pre1 + pre2);
  return pre1 + pre2;
};
date = new Date();
console.log(fib(40)); // 102334155
console.log(Date.now() - date); // 1 (ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œæœ‰æ—¶ä¹Ÿä¼šæ˜¯0)</code></pre><p id="f5552d4b-7f67-4d92-9373-72ba0b6cf4cc" class="">æŠŠé€’å½’å†™æˆè¿­ä»£å¾ªç¯å½¢å¼</p><pre id="d0798723-90a0-405b-a809-7ac8b855a53e" class="code code-wrap"><code>const fib2 = (n) =&gt; {
  if (n &lt; 2) {
    return n;
  }
  let a = 1;
  let b = 1;
  let temp;
  for (let i = 2; i &lt; n; i++) {
    temp = b;
    b = b + a;
    a = temp;
  }
  return b;
};
date = new Date();
console.log(fib2(40)); // 102334155
console.log(Date.now() - date); // 0 ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œæœ‰æ—¶ä¹Ÿä¼šæ˜¯1ï¼‰</code></pre></li></ul><ul id="b294775d-0719-4a44-9cbc-40a4a9883955" class="bulleted-list"><li style="list-style-type:disc">å¦‚æœæƒ³è¦ä¿æŒé€’å½’å®ç°ï¼Œä¸ºäº†è®©å¼•æ“å¯ç”¨å°¾è°ƒç”¨ä¼˜åŒ–ï¼Œå¯ä»¥é‡æ„æˆæ»¡è¶³ä¼˜åŒ–æ¡ä»¶çš„å½¢å¼<p id="90b3c07e-76b7-4b92-9145-d5954e643583" class="">ä½¿ç”¨ä¸¤ä¸ªåµŒå¥—çš„å‡½æ•°ï¼Œå¤–éƒ¨å‡½æ•°ä½œä¸ºåŸºç¡€æ¡†æ¶ï¼Œå†…éƒ¨å‡½æ•°æ‰§è¡Œé€’å½’</p><pre id="9e190149-ca77-4410-aa98-2b1259cb0fa1" class="code code-wrap"><code>// åŸºç¡€æ¡†æ¶
function fibouter(n) {
  return fibImpl(0, 1, n);
}
// æ‰§è¡Œé€’å½’
function fibImpl(a, b, n) {
  if (n == 0) {
    return a;
  }
  return fibImpl(b, a + b, n - 1);
}
date = new Date();
console.log(fibouter(40)); // 102334155
console.log(Date.now() - date); // 1 (ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œæœ‰æ—¶ä¹Ÿä¼šæ˜¯0)</code></pre><ul id="02d523c9-1d14-48d7-ac25-c23fcc779ca9" class="bulleted-list"><li style="list-style-type:circle"><code>fibImpl</code> å®é™…ä¸Šå°†<code>n</code>ä½œä¸ºé€’å½’æ·±åº¦ï¼Œ<code>a</code> ï¼Œ<code>b</code> æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¸¤ä¸ªåˆå§‹å€¼ï¼Œåªè¦ä¸æ–­æ‰§è¡Œ<code>nextA = b , nextB = a + b</code> å°±èƒ½ä¿è¯ä¸€æ­¥æ­¥å¾—åˆ°ç¬¬<code>n</code>ä¸ªæ–æ³¢é‚£å¥‘æ•°</li></ul><ul id="dbdcc118-4ff7-463d-bee0-f5a013fda99b" class="bulleted-list"><li style="list-style-type:circle"><code>fibouter</code> åŸºç¡€æ¡†æ¶æ˜¯ä¸ºäº†ä¿è¯å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‡½æ•°ç­¾åç‰¹æ€§ï¼šå³ç»™ä¸€ä¸ªä¸‹æ ‡å°±èƒ½è·å–ç¬¬nä¸ªæ–æ³¢é‚£å¥‘æ•°</li></ul></li></ul></div></div><p id="e4b71da0-3528-414d-828d-be3f627885da" class="">
</p></div></article></body></html>