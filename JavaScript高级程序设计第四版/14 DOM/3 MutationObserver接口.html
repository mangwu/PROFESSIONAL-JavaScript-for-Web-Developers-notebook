<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>3. MutationObserveræ¥å£</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style><link rel="stylesheet" href="../../style.css"></head><body><article id="74c5d8a6-6437-4b63-882e-da30752c2cd1" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/woodcuts_5.jpg" style="object-position:center 100%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">ğŸªƒ</span></div><h1 class="page-title">3. MutationObserveræ¥å£</h1></header><div class="page-body"><p id="deb22640-bfc1-459d-b441-3be3a13251fb" class="">MutationObserveræ¥å£å®ç°äº†å¯ä»¥åœ¨DOMè¢«ä¿®æ”¹æ—¶<strong>å¼‚æ­¥æ‰§è¡Œå›è°ƒ</strong></p><p id="fee347fc-4158-474f-a3ef-435f6bb4b783" class="">ä½¿ç”¨MutationObserverå¯ä»¥<strong>è§‚å¯Ÿ</strong>æ•´ä¸ªæ–‡æ¡£ã€DOMæ ‘çš„ä¸€éƒ¨åˆ†ã€æˆ–æŸä¸ªå…ƒç´ ï¼Œæ­¤å¤–è¿˜å¯ä»¥è§‚å¯Ÿå…ƒç´ å±æ€§ã€å­èŠ‚ç‚¹ã€æ–‡æœ¬æˆ–è€…å‰ä¸‰è€…çš„<strong>ä»»æ„ç»„åˆå˜åŒ–</strong></p><p id="d74378db-5273-48d6-9e9c-580f14adba88" class=""><strong>Mutation</strong>åœ¨è‹±è¯­ä¸­æ„ä¸ºçªå˜ï¼Œåœ¨å‰ç«¯é¢†åŸŸï¼Œå®ƒå¸¸è¢«æŒ‡ä¸º <strong>DOM å…ƒç´ æ‰€ç»å†çš„å˜åŒ–</strong>æˆ– æ¸²æŸ“DOMå…ƒç´ çš„ <strong>çŠ¶æ€çš„å˜åŒ–</strong></p><figure class="block-color-blue_background callout" style="white-space:pre-wrap;display:flex" id="5d4ed01a-f4e6-47fa-b060-4d007dcc0def"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">æ³¨æ„ï¼šMutaionObserveræ¥å£çš„å¼•å…¥æ˜¯ä¸ºäº†å–ä»£åºŸå¼ƒçš„MutationEvent</div></figure><div id="15c3cbe2-3958-4eca-bb75-c870cbe93f3d" class="column-list"><div id="7be77b76-40e1-4f37-b5d4-dacd9633f519" style="width:18.75%" class="column"><nav id="b20ce80f-ac50-4a0e-98b6-64222da06a22" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b637e58e-8ca5-43cb-9806-42358962707a">3.0 MutationObserveræ¥å£è§„èŒƒ</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#461fe270-61d2-451b-9c4a-46a20aa3ffee">3.1 åŸºæœ¬ç”¨æ³•</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e76b14c3-c4b7-40ba-b297-ad0270d12ce3">3.1.1 observe()æ–¹æ³•</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#37761023-9920-458c-a655-ba6f56257751">3.1.2 å›è°ƒä¸MutationRecord</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ea3bcce5-8985-4194-bc83-efaf72d7fcbe">3.1.3 disconnect()æ–¹æ³•</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#22737abb-1a3e-4d74-b901-05ef16ae0f3a">3.1.4 å¤ç”¨MutationObserverï¼ˆMultiplexing a MuatationObserverï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f445a238-0b7b-4559-85cd-f8250cbf2e63">3.1.5 é‡ç”¨MutationObserverï¼ˆReusing a MutationObserverï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a20322ac-5a5d-414e-85a6-0819b03abd67">3.2 MutationObserverInitä¸è§‚å¯ŸèŒƒå›´ï¼ˆControlling the Observer scope with MutationObserverInitï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#32d51b07-daa7-434c-a2cc-404d022ca159">3.2.1 è§‚å¯Ÿå±æ€§</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5e669da9-94a7-4e69-922f-5d51d67eb18b">3.2.2 è§‚å¯Ÿå­—ç¬¦æ•°æ®</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#78055929-c745-422a-9fb0-119fa37c8e14">3.2.3 è§‚å¯Ÿå­èŠ‚ç‚¹</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7d069d70-03ca-45de-8faa-165e29ac8cc3">3.2.4 è§‚å¯Ÿå­æ ‘</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#38197e37-48c7-4f2a-894a-db9b9ea15041">3.3 å¼‚æ­¥å›è°ƒä¸è®°å½•é˜Ÿåˆ—ï¼ˆAsync Callbacks and Record Queueï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ffb74362-7024-4eb4-801f-03969127c444">3.3.1 è®°å½•é˜Ÿåˆ—çš„è¡Œä¸º</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c5ccb941-4251-440a-b9f9-719a32bc4bbf">3.3.2 takeRecords()æ–¹æ³•</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#f0537b46-64b2-48fb-8fc3-c0b284eaa769">3.4 æ€§èƒ½ã€å†…å­˜ä¸åƒåœ¾å›æ”¶ï¼ˆ<strong>Performance, Memory, and Garbage Collection</strong>ï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#522d2610-5c0f-4a6b-809b-dd79f95af982">3.4.1 MutationObserverçš„å¼•ç”¨ï¼ˆ<strong>References</strong>ï¼‰</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#90724117-f837-4e64-9259-8fbc3842df12">3.4.2 MutationRecordçš„å¼•ç”¨ï¼ˆ<strong>References</strong>ï¼‰</a></div></nav><p id="c070d1b8-c394-49ab-84bf-2ac81673e56f" class="">
</p></div><div id="43114f72-fc3f-4fd7-a5c0-e6736a8aaaff" style="width:81.25%" class="column"><h1 id="b637e58e-8ca5-43cb-9806-42358962707a" class="">3.0 MutationObserveræ¥å£è§„èŒƒ</h1><ul id="eca029d5-5552-41d2-a93d-d27d389a8f98" class="bulleted-list"><li style="list-style-type:disc">DOM Standardè§„èŒƒå®šä¹‰äº† <a href="https://dom.spec.whatwg.org/#interface-mutationobserver">MutationObserver</a> æ¥å£ï¼Œå¦‚ä¸‹<pre id="870bbd2d-d06b-43fd-9ea1-93b19774af19" class="code code-wrap"><code>[Exposed=Window]
interface MutationObserver {
  constructor(MutationCallback callback);

  undefined observe(Node target, optional MutationObserverInit options = {});
  undefined disconnect();
  sequence&lt;MutationRecord&gt; takeRecords();
};

callback MutationCallback = undefined (sequence&lt;MutationRecord&gt; mutations, MutationObserver observer);

dictionary MutationObserverInit {
  boolean childList = false;
  boolean attributes;
  boolean characterData;
  boolean subtree = false;
  boolean attributeOldValue;
  boolean characterDataOldValue;
  sequence&lt;DOMString&gt; attributeFilter;
};</code></pre></li></ul><ul id="8f171134-d03e-40a7-a36e-b09391335d32" class="bulleted-list"><li style="list-style-type:disc">ä¸€ä¸ª<code>MutationObserver</code>å¯¹è±¡å¯ä»¥ç”¨æ¥è§‚å¯ŸDOMæ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„<strong>å˜åŒ–</strong>ï¼ˆ<strong>mutation</strong>ï¼‰</li></ul><ul id="8d22a404-56cd-46ce-a0fe-eaa4305573f4" class="bulleted-list"><li style="list-style-type:disc">æ¯ä¸ª<code>MutationObserver</code> å¯¹è±¡éƒ½æœ‰ä»¥ä¸‹ç›¸å…³æ¦‚å¿µ<ul id="4668b59c-9ade-4f30-8f76-f0632a103a0c" class="bulleted-list"><li style="list-style-type:circle">åˆ›å»ºæ—¶è®¾ç½®çš„<strong>å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰</strong></li></ul><ul id="62b4339a-e589-4456-bde1-c2cba1f72ca2" class="bulleted-list"><li style="list-style-type:circle">ä¸€ä¸ª<strong>èŠ‚ç‚¹åˆ—è¡¨</strong>(<strong>node list</strong>ï¼ŒèŠ‚ç‚¹çš„åˆ—è¡¨)ï¼Œåˆå§‹ä¸ºç©ºã€‚</li></ul><ul id="b6c514d3-467f-45dc-a92e-71f423afde31" class="bulleted-list"><li style="list-style-type:circle">ä¸€ä¸ª<strong>è®°å½•é˜Ÿåˆ—</strong>(ç”±é›¶ä¸ªæˆ–å¤šä¸ª<code>MutationRecord</code>å¯¹è±¡ç»„æˆçš„é˜Ÿåˆ—)ï¼Œæœ€åˆæ˜¯ç©ºçš„ã€‚</li></ul></li></ul><ul id="35c324d2-6f93-4c3a-a43d-1032d6c1d540" class="bulleted-list"><li style="list-style-type:disc">å¯¹ç½‘é¡µå¼€å‘è€…è€Œè¨€ï¼Œéè§„èŒƒåŒ–çš„ç”¨æ³•è§£é‡Šå¦‚ä¸‹<ul id="5b7d96b4-d247-419e-8c80-2b1e59009c6f" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked"><code>observer = new MutationObserver(callback)</code> </span><p id="a0b7d0cf-e96e-4c41-b90b-25b3410e102a" class="">æ„é€ ä¸€ä¸ª<code>MutationObjserver</code>å¯¹è±¡å¹¶è®¾ç½®å…¶å›è°ƒå‡½æ•°ä¸º<code>callback</code> ï¼›è°ƒç”¨å›è°ƒæ—¶ï¼Œ<code>MutationRecord</code> å¯¹è±¡åˆ—è¡¨ä½œä¸ºç¬¬ä¸€ä¸ªï¼ˆå›è°ƒå‡½æ•°çš„ï¼‰å‚æ•°ï¼Œæ„é€ çš„<code>MutationObserver</code> å¯¹è±¡ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼›åœ¨<code>observer()</code> æ–¹æ³•<strong>æ³¨å†Œçš„èŠ‚ç‚¹</strong>å‘ç”Ÿ<strong>å˜åŒ–</strong>ï¼ˆ<strong>mutation</strong>ï¼‰åè°ƒç”¨å®ƒï¼ˆå›è°ƒå‡½æ•°ï¼‰</p></li></ul><ul id="357f3b81-f9f2-41d4-8735-3767f827ef36" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked"><code>observer.observer(target, options)</code> </span><p id="78a1a702-b5b7-4a97-aaa6-d442d909225e" class="">æ³¨å†ŒèŠ‚ç‚¹ï¼Œå…¶å…·ä½“èŒèƒ½ä¸º æŒ‡å®šç”¨æˆ·ä»£ç†éœ€è¦<strong>è§‚å¯Ÿ</strong>(<strong>observe</strong>)çš„ç›®æ ‡ï¼ˆ<strong>targetï¼Œ</strong>èŠ‚ç‚¹ï¼‰ï¼Œå¹¶æ ¹æ®é€‰é¡¹ï¼ˆ<strong>optionsï¼Œ</strong>ä¸€ä¸ªå¯¹è±¡ï¼‰ç»™å‡ºæŠ¥å‘Šä»»ä½•<strong>å˜åŒ–</strong>ï¼ˆ<strong>mutation</strong>ï¼‰çš„æ ‡å‡†ã€‚</p><p id="8106479a-cd5d-4954-a8ec-bce27efa5c53" class=""><code>options</code>å‚æ•°å…è®¸é€šè¿‡å¯¹è±¡æˆå‘˜ï¼ˆå³å±æ€§ï¼‰è®¾ç½®<strong>å˜åŒ–è§‚å¯Ÿé€‰é¡¹</strong>ï¼ˆ<strong>mutation observation options</strong>ï¼‰ï¼Œä»¥ä¸‹æ˜¯å¯ä»¥ä½¿ç”¨çš„å¯¹è±¡æˆå‘˜</p><ul id="42b8eb37-12a5-4ede-9eff-f991559073c4" class="bulleted-list"><li style="list-style-type:disc"><code><strong>childList</strong></code><strong> ï¼Œ</strong>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€æ±‚ç”¨æˆ·ä»£ç†è§‚å¯Ÿç›®æ ‡çš„<strong>å­èŠ‚ç‚¹</strong>ï¼ˆ<strong>children</strong>ï¼‰å˜åŒ–ï¼Œä¸º<code>true</code> æ—¶è¡¨ç¤ºç›®æ ‡çš„å­èŠ‚ç‚¹å˜åŒ–ä¹Ÿä¼šè¢«è§‚å¯Ÿ</li></ul><ul id="ac16e137-3ade-4b8a-9163-e6bdc8874d31" class="bulleted-list"><li style="list-style-type:disc"><code><strong>attributes</strong></code><strong> </strong>ï¼Œå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€æ±‚ç”¨æˆ·ä»£ç†è§‚å¯Ÿç›®æ ‡çš„å±æ€§ï¼ˆ<strong>attributes</strong>ï¼‰å˜åŒ–ï¼Œä¸º<code>true</code> æ—¶è¡¨ç¤ºç›®æ ‡çš„å±æ€§å˜åŒ–ä¹Ÿä¼šè¢«è§‚å¯Ÿï¼Œå¦‚æœåé¢çš„<code>attributeOldValue</code> æˆ–<code>attributeFilter</code> è¢«èµ‹å€¼äº†ï¼Œ<code>attributes</code> é€‰é¡¹ä¼šè¢«å¿½ç•¥</li></ul><ul id="fe0991a8-a43a-4519-af08-3efdeb7f2c85" class="bulleted-list"><li style="list-style-type:disc"><strong><code>characterData</code></strong><strong> </strong>ï¼Œå¸ƒå°”å€¼ï¼Œ<strong> </strong>è¡¨ç¤ºæ˜¯å¦éœ€æ±‚ç”¨æˆ·ä»£ç†è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹çš„æ•°æ®ï¼ˆ<strong>data</strong>ï¼ŒæŒ‡ç»§æ‰¿äº<code>CharacterData</code> æ¥å£çš„éƒ¨åˆ†ç±»å‹èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬æ–‡æœ¬èŠ‚ç‚¹ï¼ŒProcessingInstructionèŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹ï¼‰å˜åŒ–ï¼Œä¸º<code>true</code> æ—¶è¡¨ç¤ºç›®æ ‡çš„æ•°æ®å˜åŒ–ä¹Ÿä¼šè¢«è§‚å¯Ÿï¼Œå¦‚æœåé¢çš„<code>characterDataOldValue</code> è¢«èµ‹å€¼äº†ï¼Œ<code>characterData</code> é€‰é¡¹ä¼šè¢«å¿½ç•¥</li></ul><ul id="f9da93ba-b605-403d-a08b-99b10e93f717" class="bulleted-list"><li style="list-style-type:disc"><code><strong>subtree</strong></code><strong> </strong>ï¼Œå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éœ€æ±‚ç”¨æˆ·ä»£ç†ä¸ä»…è¦è§‚å¯Ÿç›®æ ‡çš„å˜åŒ–ï¼Œè¿˜è¦è§‚å¯Ÿç›®æ ‡çš„<strong>åä»£</strong>ï¼ˆ<strong>descendants</strong>ï¼‰çš„å˜åŒ–ï¼Œä¸º<code>true</code> æ—¶è¡¨ç¤ºäºŒè€…éƒ½è¿›è¡Œè§‚å¯Ÿ</li></ul><ul id="5bd41e1d-3ce7-4423-954b-747b82595343" class="bulleted-list"><li style="list-style-type:disc"><code>attributeOldValue</code> ï¼Œå¸ƒå°”å€¼ï¼Œå¦‚æœ<code>attributes</code> é€‰é¡¹ä¸º<code>true</code> æˆ–è¢«å¿½ç•¥åˆ™ä¸º<code>true</code> ï¼Œï¼ˆè®¾ç½®ä¸º<code>true</code> )éœ€è¦è®°å½•<strong>å˜åŒ–</strong>(<strong>mutation</strong>)å‰çš„ç›®æ ‡å±æ€§å€¼</li></ul><ul id="079d5d5b-057d-48bb-a6d3-7a9e613223ef" class="bulleted-list"><li style="list-style-type:disc"><code>characterDataOldValue</code> ï¼Œå¸ƒå°”å€¼ï¼Œå¦‚æœè¢«æŒ‡å®šï¼Œ<code>attributes</code> é€‰é¡¹è¢«å¿½ç•¥ ï¼Œï¼ˆè®¾ç½®ä¸º<code>true</code>ï¼‰éœ€è¦è®°å½•ç›®æ ‡åœ¨<strong>å˜åŒ–</strong>(<strong>mutation</strong>)å‰çš„ç›®æ ‡æ•°æ®å€¼</li></ul><ul id="f8c387ca-6875-44e3-bddf-785dda4d2b7f" class="bulleted-list"><li style="list-style-type:disc"><code>attributeFilter</code> ï¼Œåˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰ç±»å‹ï¼Œåœ¨ä¸æ˜¯æ‰€æœ‰ç›®æ ‡çš„å±æ€§å˜åŒ–éƒ½éœ€è¦è¢«è§‚å¯Ÿæ—¶ä½¿ç”¨ï¼Œå®ƒè¢«èµ‹å€¼ä¸ºéœ€è¢«è§‚å¯Ÿçš„<strong>å±æ€§åç§°</strong>ï¼ˆ<strong>local nameï¼Œä¸å¸¦æœ‰namespaceå‘½åç©ºé—´</strong>ï¼‰å­—ç¬¦ä¸²æ•°ç»„ï¼Œå¦‚æœè¢«æŒ‡å®šï¼Œ<code>attributes</code> é€‰é¡¹è¢«å¿½ç•¥</li></ul></li></ul><ul id="617ea175-40a1-4e8d-a3bb-0270ec56172f" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked"><code>observer.disconnect()</code></span><p id="245dbc2f-4717-44b6-bc67-6478ce31145a" class="">åœæ­¢<strong>è§‚å¯Ÿè€…</strong>(<strong>observer</strong>)è§‚å¯Ÿä»»ä½•å˜åŒ–ã€‚åœ¨å†æ¬¡ä½¿ç”¨<code>observe()</code>æ–¹æ³•ä¹‹å‰ï¼Œ<code>observer</code>å¯¹è±¡çš„å›è°ƒå‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ã€‚</p></li></ul><ul id="d4b4d035-8e0d-46bc-b867-ed290e9d56d4" class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked"><code>observer.takeRecords()</code> </span><p id="8da6a7a7-53dc-45dc-95ac-4364631c64b0" class="">æ¸…ç©ºè®°å½•é˜Ÿåˆ—å¹¶è¿”å›å…¶ä¸­çš„å†…å®¹ã€‚</p></li></ul></li></ul><h1 id="461fe270-61d2-451b-9c4a-46a20aa3ffee" class="">3.1 åŸºæœ¬ç”¨æ³•</h1><ul id="029b42d5-a8bb-480e-90f9-716585b0efd1" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserver</code> çš„å®ä¾‹è¦é€šè¿‡è°ƒç”¨<code>MutationObserver</code> æ„é€ å‡½æ•°å¹¶ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥åˆ›å»º<pre id="9ff523f5-65a5-4275-a8c0-3462fce035c1" class="code code-wrap"><code>let observer = new MutationObserver(() =&gt; console.log(&quot;DOM was mutated!&quot;))</code></pre></li></ul><h2 id="e76b14c3-c4b7-40ba-b297-ad0270d12ce3" class="">3.1.1 observe()æ–¹æ³•</h2><ul id="41cf67f0-ca7f-4766-9f38-14101605113d" class="bulleted-list"><li style="list-style-type:disc">æ–°åˆ›å»ºçš„<code>MutationObserver</code> å®ä¾‹ä¸ä¼šå…³è”DOMçš„ä»»ä½•éƒ¨åˆ†ï¼Œè¦æŠŠè¿™ä¸ª<code>observer</code>ä¸DOMå…³è”èµ·æ¥éœ€è¦ä½¿ç”¨<code>observe()</code> </li></ul><ul id="002be61b-ac45-42fd-b2dd-5a61f787d5a5" class="bulleted-list"><li style="list-style-type:disc">è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå¿…é¡»çš„å‚æ•°<ul id="70394b69-bec0-4159-adc8-6e28f17a33fd" class="bulleted-list"><li style="list-style-type:circle">è¦è§‚å¯Ÿå…¶å˜åŒ–çš„DOMèŠ‚ç‚¹</li></ul><ul id="94ff0b58-8c57-4d47-84cb-f9445e13733c" class="bulleted-list"><li style="list-style-type:circle">ä»¥åŠä¸€ä¸ª<code>MutationObserverInit</code>å¯¹è±¡ï¼ˆå°±æ˜¯ä¸Šé¢æ¥å£è§„èŒƒè¯´çš„è¦è®¾ç½®çš„è§‚å¯ŸæŠ¥å‘Šæ ‡å‡†ï¼‰</li></ul></li></ul><ul id="5c7bc1d9-677d-4931-9520-8847ad949ca8" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserverInit</code> å¯¹è±¡ç”¨äºæ§åˆ¶è§‚å¯Ÿå“ªäº›æ–¹é¢çš„å˜åŒ–ï¼Œæ˜¯ä¸€ä¸ªé”®/å€¼å¯¹å½¢å¼é…ç½®é€‰é¡¹çš„å­—å…¸ï¼Œå¦‚ä¸‹<pre id="3901da6e-623f-4c7c-9161-0a12f5f70210" class="code code-wrap"><code>let observer = new MutationObserver(() =&gt;
  console.log(&quot;&lt;body&gt; attributes changed&quot;)
);

observer.observe(document.body, {
  attributes: true,
});

document.body.className = &quot;foo&quot;;

console.log(&quot;Changed body class&quot;)

// æ‰“å°ç»“æœ
// Changed body class
// &lt;body&gt; attributes changed</code></pre><ul id="a819f191-2fed-43c5-bc64-59dc51d5eaca" class="bulleted-list"><li style="list-style-type:circle">æ‰§è¡Œä»¥ä¸Šä»£ç åï¼Œ&lt;body&gt;å…ƒç´ ä¸Šä»»ä½•å±æ€§å‘ç”Ÿå˜åŒ–éƒ½ä¼šè¢«è¿™ä¸ª<code>MutationObserver</code> å®ä¾‹å‘ç°ï¼Œç„¶åå°±ä¼š<strong>å¼‚æ­¥æ‰§è¡Œ</strong>æ³¨å†Œçš„å›è°ƒå‡½æ•°</li></ul><ul id="ea92a2ef-4aed-40de-91a4-b733179e892b" class="bulleted-list"><li style="list-style-type:circle">&lt;body&gt;å…ƒç´ åä»£çš„ä¿®æ”¹æˆ–å…¶å®ƒ<strong>éå±æ€§</strong>ä¿®æ”¹éƒ½ä¸ä¼šé™¤æ³•å›è°ƒè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå› ä¸º<code>MutationObserverInit</code> å¯¹è±¡è®¾ç½®ä»…è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹çš„å±æ€§ï¼‰</li></ul></li></ul><h2 id="37761023-9920-458c-a655-ba6f56257751" class="">3.1.2 å›è°ƒä¸MutationRecord</h2><ul id="3c8b33fd-9fee-4b36-8a63-10d60631ea58" class="bulleted-list"><li style="list-style-type:disc">DOM Standardè§„èŒƒçš„ <a href="https://dom.spec.whatwg.org/#mutationrecord"><code>MutationRecord</code></a><a href="https://dom.spec.whatwg.org/#mutationrecord"> </a>æ¥å£å®šä¹‰å¦‚ä¸‹</li></ul><pre id="43247f46-5faa-4b20-9d83-98b89d279a69" class="code code-wrap"><code>[Exposed=Window]
interface MutationRecord {
  readonly attributeDOMStringtype;
  [SameObject] readonly attributeNodetarget;
  [SameObject] readonly attributeNodeListaddedNodes;
  [SameObject] readonly attributeNodeListremovedNodes;
  readonly attributeNode?previousSibling;
  readonly attributeNode?nextSibling;
  readonly attributeDOMString?attributeName;
  readonly attributeDOMString?attributeNamespace;
  readonly attributeDOMString?oldValue;
};</code></pre><ul id="b56dd6eb-e171-4d12-829b-bbfa7fb83f03" class="bulleted-list"><li style="list-style-type:disc">è¿™ä¸ªæ¥å£å®é™…ä¸Šæ˜¯å¯¹ä¸€æ¬¡å˜åŒ–ï¼ˆ<strong>Mutation</strong>ï¼‰çš„è®°å½•ï¼Œä¸€ä¸ª<code>MuationRecord</code> å®ä¾‹åŒ…å«çš„ä¿¡æ¯åŒ…æ‹¬å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Œä»¥åŠDOMçš„å“ªä¸€äº›éƒ¨åˆ†æ”¶åˆ°äº†å½±å“</li></ul><ul id="02e3605c-dfbb-48a6-9258-60d67ad10b1e" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserver</code> å®ä¾‹çš„æ¯ä¸ªå›è°ƒéƒ½ä¼šæ”¶åˆ°ä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹æ„æˆçš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºå›è°ƒæ‰§è¡Œä¹‹å‰å¯èƒ½åŒæ—¶å‘ç”Ÿå¤šä¸ªæ»¡è¶³è§‚å¯Ÿæ¡ä»¶çš„äº‹ä»¶ï¼Œæ‰€ä»¥æ¯æ¬¡è°ƒç”¨æ‰§è¡Œå›è°ƒéƒ½ä¼šä¼ å…¥ä¸€ä¸ªåŒ…å«æŒ‰é¡ºåºå…¥é˜Ÿçš„<code>MutationRecord</code>å®ä¾‹çš„æ•°ç»„</li></ul><ul id="f299ba43-650b-4d31-a6bf-6d4ac6371dea" class="bulleted-list"><li style="list-style-type:disc">å›è°ƒå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯<code>MuatrionObserver</code> æ„é€ å‡½æ•°æœ¬èº«ï¼Œä¸‹é¢å±•ç¤ºåæ˜ äº†å±æ€§å˜åŒ–çš„<code>MutationRecord</code>å®ä¾‹çš„æ•°ç»„<pre id="740159e6-8b47-4203-8538-dc8dbd932577" class="code code-wrap"><code>let observer = new MutationObserver((mutationRecords, observer) =&gt; {
  console.log(mutationRecords);
  console.log(observer === observer);
});

observer.observe(document.body, { attributes: true });
document.body.setAttribute(&quot;foo&quot;, &quot;bar&quot;);
document.body.className = &quot;baz&quot;;</code></pre><figure id="48483ba4-a705-4de9-920b-120f1de5bd6f" class="image"><a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3/MutationRecord.png"><img style="width:624px" src="3%20MutationObserver%E6%8E%A5%E5%8F%A3/MutationRecord.png"/></a></figure><ul id="ff387fe3-3caa-4e8c-8b99-6ea318217371" class="bulleted-list"><li style="list-style-type:circle">è¿™é‡Œè¿›è¡Œäº†ä¸¤æ¬¡å±æ€§çš„è®¾ç½®ï¼Œä¸€æ¬¡æ˜¯è‡ªå®šä¹‰å±æ€§ï¼Œä¸€æ¬¡æ˜¯ç±»åç§°è®¾ç½®ï¼ŒæŒ‰é¡ºåº<code>MutationRecord</code> ä¿å­˜åˆ°äº†ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¹¶æä¾›äº†è¿™ä¸¤æ¬¡å±æ€§å˜åŒ–çš„è®°å½•</li></ul><ul id="50220fc8-9cf4-4eb3-9d9e-44b27c7e57dd" class="bulleted-list"><li style="list-style-type:circle">å› ä¸º<code>MutationObserverInit</code> å¯¹è±¡åªè¦æ±‚è®°å½•<code>attributes</code> ï¼Œæ‰€ä»¥<code>MutationRecord</code> ä¹Ÿå°±åªè®°å½•äº†<code>attributeName</code> ï¼ˆå˜åŒ–çš„å±æ€§åç§°ï¼‰ã€<code>target</code> ï¼ˆå˜åŒ–çš„ç›®æ ‡èŠ‚ç‚¹ï¼‰ã€å’Œ<code>type</code> ï¼ˆç›®æ ‡èŠ‚ç‚¹å˜åŒ–çš„ç±»å‹ï¼‰</li></ul></li></ul><ul id="fa92bdab-d5b4-435e-830c-7afc771d1596" class="bulleted-list"><li style="list-style-type:disc">åœ¨ä¹‹å‰çš„ä»‹ç»ä¸­ï¼Œè®¾ç½®å±æ€§é™¤äº†<code>setAttribute</code> å¤–ï¼Œè¿˜æœ‰å¯¹å‘½åç©ºé—´ä¸­å±æ€§çš„è®¾ç½®ï¼Œ<code>setAttributeNs()</code> ,è™½ç„¶è¿™ä¸ªæ–¹æ³•åœ¨XMLæ–‡æ¡£ä¸­æ›´æœ‰ç”¨å¤„ï¼Œä½†æ˜¯åœ¨HTMLä½¿ç”¨ä»ç„¶æ˜¯ä¼šè¢«<code>MutationObserver</code>å¯¹è±¡æ‰€è§‚å¯Ÿï¼Œå¦‚ä¸‹<pre id="b8d91bda-df18-4dc0-8167-2c489a4dac21" class="code code-wrap"><code>let observer = new MutationObserver((mutationRecords, observer) =&gt; {
  console.log(mutationRecords);
});

observer.observe(document.body, { attributes: true });

document.body.setAttributeNS(&quot;localhost:8000&quot;, &quot;foo&quot;, &quot;bar&quot;);</code></pre><figure id="e7e36d7a-bad3-4dbf-96bd-220782351019" class="image"><a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3/attributeNSMutationRecord.png"><img style="width:432px" src="3%20MutationObserver%E6%8E%A5%E5%8F%A3/attributeNSMutationRecord.png"/></a></figure><ul id="e007e915-40c5-4eb5-b541-97bf62d1ad38" class="bulleted-list"><li style="list-style-type:circle"><code>setAttributeNS()</code> è®¾ç½®å±æ€§è§¦å‘çš„å›è°ƒå‡½æ•°è®°å½•çš„<code>mutationRecords</code> ä¸­çš„è®°å½•å®ä¾‹ä¸<code>setAttribute()</code> çš„å”¯ä¸€åŒºåˆ«åœ¨äºå¤šè®°å½•äº†ä¸€ä¸ª<code>attributeNamespace</code> å±æ€§</li></ul></li></ul><ul id="7df9ca62-80ed-4acb-89b3-26967ba573f7" class="bulleted-list"><li style="list-style-type:disc">ä¸‹è¡¨åˆ—å‡ºäº†<code>MutationRecord</code> å®ä¾‹çš„å±æ€§å’Œæè¿°<table id="e6769d93-b45a-4644-bc9f-b8eb7a7b003b" class="simple-table"><tbody><tr id="3d965890-88cc-4b24-a25c-9e6aeeb42d62"><td id="tY[K" class="">å±æ€§</td><td id="He_O" class="" style="width:451px">è¯´æ˜</td></tr><tr id="c03a4b3a-7f5c-4179-bd19-def6ec5bce9c"><td id="tY[K" class="">target</td><td id="He_O" class="" style="width:451px">è¢«ä¿®æ”¹å½±å“çš„ç›®æ ‡èŠ‚ç‚¹</td></tr><tr id="1fe896ed-f2f3-4160-a5ce-c5089c9f5de6"><td id="tY[K" class="">type</td><td id="He_O" class="" style="width:451px">å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå˜åŒ–çš„ç±»å‹ï¼šâ€œattributeâ€ã€â€characterDataâ€æˆ–â€childListâ€</td></tr><tr id="bc2e03e6-86df-4bb8-80d3-71bff12e3373"><td id="tY[K" class="">oldValue</td><td id="He_O" class="" style="width:451px">å¦‚æœåœ¨<code>MutationObserverInit</code> å¯¹è±¡ä¸­å¯ç”¨(attributeOldValueæˆ–characterDataOldValue)ï¼Œâ€œattributesâ€æˆ–â€characterDataâ€çš„å˜åŒ–äº‹ä»¶ä¼šè®¾ç½®è¿™ä¸ªå±æ€§ä¸ºè¢«æ›¿ä»£çš„å€¼ï¼›â€childListâ€ç±»å‹çš„å˜åŒ–å§‹ç»ˆå°†è¿™ä¸ªå±æ€§è®¾ç½®ä¸ºnull</td></tr><tr id="164c3edd-5371-4835-a10d-b1bd171e53ea"><td id="tY[K" class="">attributeName</td><td id="He_O" class="" style="width:451px">å¯¹äºâ€attributesâ€ç±»å‹çš„å˜åŒ–ï¼Œè¿™é‡Œä¿å­˜è¢«ä¿®æ”¹å±æ€§çš„åå­—</td></tr><tr id="ca8c22a4-5082-43c3-b1ff-b38be6e1c740"><td id="tY[K" class="">attributeNamespace</td><td id="He_O" class="" style="width:451px">å¯¹äºä½¿ç”¨äº†å‘½åç©ºé—´çš„â€attributesâ€ç±»å‹çš„å˜åŒ–ï¼Œè¿™é‡Œä¿å­˜è¢«ä¿®æ”¹å±æ€§çš„å‘½åç©ºé—´åå­—ï¼Œå…¶å®ƒå˜åŒ–äº‹ä»¶ä¼šå°†è¿™ä¸ªå±æ€§å€¼è®¾ç½®ä¸ºnull</td></tr><tr id="4dcd5c29-2128-43de-894b-666811a005a8"><td id="tY[K" class="">addedNodes</td><td id="He_O" class="" style="width:451px">å¯¹äºâ€childListâ€ç±»å‹çš„å˜åŒ–ï¼Œè¿”å›åŒ…å«å˜åŒ–ä¸­æ·»åŠ èŠ‚ç‚¹çš„NodeListé»˜ï¼›è®¤ä¸ºç©ºNodeList</td></tr><tr id="c0973b6f-3820-43ed-a474-e131ff294f20"><td id="tY[K" class="">removedNodes</td><td id="He_O" class="" style="width:451px">å¯¹äºâ€childListâ€œç±»å‹çš„å˜åŒ–ï¼Œè¿”å›åŒ…å«å˜åŒ–ä¸­åˆ é™¤èŠ‚ç‚¹çš„NodeListï¼›é»˜è®¤ä¸ºç©ºNodeList</td></tr><tr id="713611e7-93dd-4de6-89be-172485c78211"><td id="tY[K" class="">previousSibling</td><td id="He_O" class="" style="width:451px">å¯¹äºâ€childListâ€œç±»å‹çš„å˜åŒ–ï¼Œè¿”å›å˜åŒ–èŠ‚ç‚¹çš„å‰ä¸€ä¸ªåŒèƒNodeï¼›é»˜è®¤ä¸ºnull</td></tr><tr id="ef650bd3-30c6-4094-b98a-783fe6a51869"><td id="tY[K" class="">nextSibling</td><td id="He_O" class="" style="width:451px">å¯¹äºâ€childListâ€ç±»å‹çš„å˜åŒ–ï¼Œè¿”å›å˜åŒ–èŠ‚ç‚¹çš„åä¸€ä¸ªåŒèƒNodeï¼›é»˜è®¤ä¸ºnull</td></tr></tbody></table></li></ul><ul id="73ca3dfe-105e-42c5-90f2-f62ae4527812" class="bulleted-list"><li style="list-style-type:disc">å¯¹äº<code>childList</code>ç±»å‹çš„å˜åŒ–ï¼Œæœ‰å¦‚ä¸‹ä¾‹å­<pre id="6805385a-0e65-4454-8919-ff6246e26ffa" class="code code-wrap"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((MutationRecords) =&gt; {
  console.log(MutationRecords);
});
observer.observe(div, { childList: true });
div.appendChild(document.createTextNode(&quot;ä½ å¥½&quot;)); // â‘ 
div.textContent = &quot;hello&quot;; // â‘¡
div.childNodes[0].textContent = &quot;hello2&quot;; // â‘¢
div.removeChild(div.firstChild); // â‘£
const p = document.createElement(&quot;p&quot;);
p.textContent = &quot;Hello&quot;;
div.appendChild(p); // â‘¤
const span = document.createElement(&quot;span&quot;);
span.textContent = &quot;ä½ å¥½&quot;;
p.appendChild(span); // â‘¥</code></pre><figure id="0fa284b7-91f5-4d4a-a068-59662a17d6da" class="image"><a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3/childList.png"><img style="width:1155px" src="3%20MutationObserver%E6%8E%A5%E5%8F%A3/childList.png"/></a></figure><ul id="ddd36b0c-f574-4900-81da-c3b9d97019f2" class="bulleted-list"><li style="list-style-type:circle"><code>childList</code> ç±»å‹çš„å˜åŒ–åªé’ˆå¯¹ç›®æ ‡èŠ‚ç‚¹çš„<strong>ç›´æ¥å­èŠ‚ç‚¹</strong>çš„å˜åŒ–ï¼Œè¯´ç®€å•ç‚¹å°±æ˜¯ç›®æ ‡èŠ‚ç‚¹çš„<code>childNodes</code> ä¸­çš„èŠ‚ç‚¹å˜åŒ–</li></ul><ul id="924fe51b-dbc1-4486-984e-b1b06edc0506" class="bulleted-list"><li style="list-style-type:circle">ç›´æ¥åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šæ–°å¢ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ“ä½œâ‘ ï¼Œç›®æ ‡èŠ‚ç‚¹ï¼ˆdivï¼‰çš„<code>childNodes</code> å‘ç”Ÿæ”¹å˜ï¼Œæ–°å¢äº†ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹çš„<code>addedNodes</code>å°±æ˜¯è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼›<code>childNodes</code> ä¸ºåŒ…å«ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¸²æ–‡æœ¬èŠ‚ç‚¹çš„<code>NodeLists</code> ï¼Œå˜åŒ–åä»ç„¶å­˜åœ¨ï¼Œä¸å­˜åœ¨ç§»é™¤çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥<code>removedNodes</code> ä¸ºç©º<code>NodeLists</code> ï¼›è€Œ<code>previousSibling</code> å°±æ˜¯å½“å‰æ–°å¢çš„èŠ‚ç‚¹çš„å‰ä¸€ä¸ªåŒèƒèŠ‚ç‚¹ï¼ˆç©ºå­—ç¬¦ä¸²æ–‡æœ¬èŠ‚ç‚¹ï¼‰ï¼Œæ²¡æœ‰<code>nextSibling</code> ï¼Œå› ä¸ºé»˜è®¤æ–°å¢çš„æ–‡æœ¬èŠ‚ç‚¹åœ¨<code>childNodes</code> çš„æœ€å</li></ul><ul id="1a5e50b7-c7a5-4183-9aab-ac450cf6f961" class="bulleted-list"><li style="list-style-type:circle">ç›´æ¥ä¿®æ”¹ç›®æ ‡èŠ‚ç‚¹çš„<code>textContent</code> ï¼Œä¹Ÿå°±æ˜¯æ“ä½œâ‘¡ï¼Œç›®æ ‡èŠ‚ç‚¹ï¼ˆdivï¼‰çš„<code>childNodes</code> å‘ç”Ÿæ”¹å˜ï¼Œæ•´ä¸ª<code>childNodes</code> ç›´æ¥å˜æˆäº†ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª<code>MutationRecord</code> å®ä¾‹çš„<code>addedNodes</code> å°±æ˜¯æ–°çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œ<code>removedNodes</code> å°±æ˜¯ä¹‹å‰çš„ä¸¤ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œå› ä¸ºç›®æ ‡èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°±åªæœ‰å½“å‰çš„æ–°æ–‡æœ¬èŠ‚ç‚¹ï¼Œæ‰€ä»¥<code>previousSibling</code> å’Œ<code>nextSibling</code> éƒ½æ˜¯<code>null</code></li></ul><ul id="e3cbc931-de7f-4f93-b85e-7960addcd297" class="bulleted-list"><li style="list-style-type:circle">ä¿®æ”¹ç›®æ ‡èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„<code>textContent</code> ï¼Œä¹Ÿå°±æ˜¯æ“ä½œâ‘¢ï¼Œä¸ä¼šè§¦å‘<code>observer</code> å¯¹è±¡çš„å›è°ƒå‡½æ•°ï¼Œå› ä¸º<code>observe()</code> æ–¹æ³•è®¾ç½®ä¸º<code>childList</code> ï¼Œå³ä»…è§‚å¯Ÿ<strong>ç›®æ ‡èŠ‚ç‚¹çš„ç›´æ¥å­èŠ‚ç‚¹</strong>å˜åŒ–ï¼Œä¿®æ”¹ç›®æ ‡èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„<code>textContent</code> ä¸ä¼šæ”¹å˜ç›®æ ‡èŠ‚ç‚¹çš„ç›´æ¥å­èŠ‚ç‚¹å¼•ç”¨ï¼ˆå³<code>childNodes</code> å±æ€§çš„åˆ—è¡¨å…ƒç´ å€¼æ²¡æœ‰å˜åŒ–ï¼‰</li></ul><ul id="87655b70-a3d9-459b-996b-5e080eb070fc" class="bulleted-list"><li style="list-style-type:circle">åˆ é™¤ç›®æ ‡èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ“ä½œâ‘£ï¼Œç›®æ ‡èŠ‚ç‚¹ï¼ˆdivï¼‰çš„<code>childNodes</code> å‘ç”Ÿæ”¹å˜ï¼Œ<code>childNodes</code> ä¸­çš„æ–‡æœ¬èŠ‚ç‚¹è¢«åˆ é™¤äº†ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ª<code>MutationRecord</code> å®ä¾‹çš„<code>removedNodes</code> å°±æ˜¯è¢«åˆ é™¤çš„èŠ‚ç‚¹ï¼Œè€Œ<code>addedNodes</code> ä¸ºç©º<code>NodeList</code> ï¼›å› ä¸ºåˆ é™¤èŠ‚ç‚¹ä¸å­˜åœ¨<code>addedNodes</code> å¹¶ä¸”åˆ é™¤å<code>childNodes</code> ä¸ºç©º<code>NodeList</code>ï¼Œæ‰€ä»¥<code>previousSibling</code> å’Œ<code>nextSibling</code> éƒ½æ˜¯<code>null</code></li></ul><ul id="02932282-06fc-42b2-8d5f-de248385f17e" class="bulleted-list"><li style="list-style-type:circle">ç›´æ¥åœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šæ–°å¢ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ“ä½œâ‘¤ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„èŠ‚ç‚¹ï¼Œåœ¨ç›®æ ‡èŠ‚ç‚¹ä¸Šç›´æ¥è¿›è¡Œå¢åˆ æ”¹èŠ‚ç‚¹éƒ½ä¼šè§¦å‘<code>observer</code> å¯¹è±¡çš„å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥ç¬¬å››ä¸ª<code>MutationRecord</code> å®ä¾‹å’Œç¬¬ä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹ç±»ä¼¼ï¼Œ<code>addedNodes</code> å°±æ˜¯åŒ…å«æ–°å¢çš„å…ƒç´ èŠ‚ç‚¹ï¼ˆpï¼‰çš„<code>NodeList</code> å¯¹è±¡ï¼Œ<code>removedNodes</code> å°±æ˜¯ç©º<code>NodeList</code> ï¼Œå› ä¸ºç›®æ ‡èŠ‚ç‚¹å½“å‰å­èŠ‚ç‚¹ä¸ºç©º<code>NodeList</code> ï¼Œæ‰€ä»¥<code>previousSibling</code> å’Œ<code>nextSibling</code> éƒ½æ˜¯<code>null</code> </li></ul></li></ul><ul id="4651f4c4-eda1-455d-baf3-ca357291fd73" class="bulleted-list"><li style="list-style-type:disc">å¯¹äº<code>subtree</code> ç±»å‹çš„å˜åŒ–ï¼Œå…ˆè¦ç†è§£ï¼š<ul id="80ae07c8-adcf-43b8-96e6-b12b94df7696" class="bulleted-list"><li style="list-style-type:circle">å®ƒä¸èƒ½å•ç‹¬ä½œä¸º<code>MutationObserverInit</code> å¯¹è±¡çš„å±æ€§ï¼Œå› ä¸ºå®ƒè¡¨æ˜æ˜¯å¦éœ€æ±‚ç”¨æˆ·ä»£ç†ä¸ä»…è¦è§‚å¯Ÿç›®æ ‡çš„å˜åŒ–ï¼Œè¿˜è¦è§‚å¯Ÿç›®æ ‡çš„<strong>åä»£</strong>ï¼ˆ<strong>descendants</strong>ï¼‰çš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä½œä¸ºå¯¹è§‚å¯ŸèŒƒå›´çš„ä¸€ä¸ª<strong>æ‰©å±•</strong>ï¼Œè€Œä¸æ˜¯æŒ‡å®šè¢«è§‚å¯Ÿçš„å…·ä½“å¯¹è±¡ï¼›å¦‚æœå•ç‹¬ä½¿ç”¨<code>subtree</code> åˆ™ä¼šæµè§ˆå™¨ä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯<pre id="674cd392-d396-4e34-930b-abc966186a4b" class="code code-wrap"><code>Uncaught TypeError: Failed to execute &#x27;observe&#x27; on &#x27;MutationObserver&#x27;: The options object must set at least one of &#x27;attributes&#x27;, &#x27;characterData&#x27;, or &#x27;childList&#x27; to true.
    at 14.3.1.2 MutationRecord.js:21:10</code></pre></li></ul><ul id="c84c2fd8-6b3e-46fa-84cd-25737eb1ca6c" class="bulleted-list"><li style="list-style-type:circle">å¦‚å‰é¢ä¾‹å­ï¼Œå¢åŠ ä¸€ä¸ª<code>subtree</code> å±æ€§ï¼Œå€¼ä¸ºtrueï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹ç»“æœ<figure id="ab21dcd4-50ad-48e1-805b-47ff5145c3c9" class="image"><a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3/subtree.png"><img style="width:1162px" src="3%20MutationObserver%E6%8E%A5%E5%8F%A3/subtree.png"/></a></figure><ul id="b9b1bc29-dfae-4a0a-9522-e3d5d085ac6e" class="bulleted-list"><li style="list-style-type:square">é™¤äº†å‰4ä¸ª<code>MutationRecord</code> å®ä¾‹å’Œå‰é¢çš„è®°å½•ä¸€æ ·å¤–ï¼Œæ–°å¢äº†ä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹åœ¨æœ€å</li></ul><ul id="8a07b296-d16f-44ed-9ae1-c4d35367467f" class="bulleted-list"><li style="list-style-type:square">å› ä¸ºå¢åŠ äº†<code>subtree</code> ç±»å‹ï¼Œæ‰€ä»¥<code>observer</code> å¯¹è±¡æ³¨å†Œçš„ç›®æ ‡çš„æ‰€æœ‰åä»£èŠ‚ç‚¹éƒ½ä¼šè¢«è§‚å¯Ÿï¼Œä¹Ÿå°±æ˜¯æ“ä½œâ‘¥ï¼›<code>p</code> å…ƒç´ èŠ‚ç‚¹æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼ˆdivï¼‰çš„ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œåœ¨pèŠ‚ç‚¹ä¸Šæ–°å¢å­èŠ‚ç‚¹ä¼šè¢«è§‚å¯Ÿåˆ°ï¼Œå› ä¸ºå­èŠ‚ç‚¹å˜åŒ–çš„ç›´æ¥å¯¹è±¡æ˜¯å…ƒç´ èŠ‚ç‚¹<code>p</code> ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹çš„<code>target</code> æ˜¯èŠ‚ç‚¹<code>p</code> ï¼ˆè€Œä¸æ˜¯<code>div</code>ï¼‰ï¼Œ<code>addedNodes</code> å°±æ˜¯åŒ…å«æ–°å¢çš„<code>span</code> èŠ‚ç‚¹çš„<code>NodeList</code>ï¼Œæ²¡æœ‰åˆ é™¤ï¼Œæ‰€ä»¥<code>removedNodes</code> æ˜¯ä¸€ä¸ªç©ºçš„<code>NodeList</code> ï¼ŒåŒç†æ–°å¢çš„<code>span</code> èŠ‚ç‚¹ä½œä¸º<code>childNodes</code> çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥ï¼Œ<code>previousSibling</code> å°±æ˜¯å‰é¢çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œ<code>nextSibling</code> å°±æ˜¯<code>null</code> </li></ul></li></ul></li></ul><ul id="6634cae9-1e2c-42a0-9ec7-fcbd4f0754d6" class="bulleted-list"><li style="list-style-type:disc">å¯¹äº<strong><code>characterData</code></strong><strong> </strong>ç±»å‹çš„å˜åŒ–è€Œè¨€ï¼Œå…ˆè¦ç†è§£<ul id="cebb7cfd-902f-4183-a4a7-2ea69c8914c0" class="bulleted-list"><li style="list-style-type:circle"><code>characterData</code> ç±»å‹è¡¨ç¤ºåªå¯¹æ–‡æœ¬èŠ‚ç‚¹ï¼ŒProcessingInstructionèŠ‚ç‚¹å’Œæ³¨é‡ŠèŠ‚ç‚¹è¿›è¡Œè§‚å¯Ÿï¼Œä¸ä¼šå¯¹å…ƒç´ èŠ‚ç‚¹è¿›è¡Œè§‚å¯Ÿï¼Œå› ä¸ºå…ƒç´ èŠ‚ç‚¹çš„æ¥å£å®šä¹‰ä¸º<code>Element</code> è€Œä¸æ˜¯<code>CharacterData</code> æ¥å£</li></ul><ul id="52b69baf-763a-43cc-9781-974c4f0d3985" class="bulleted-list"><li style="list-style-type:circle"><code>subtree</code> å¯¹<code>characterData</code> ç±»å‹ä¸€èˆ¬æ— æ•ˆï¼Œå› ä¸ºHTMLå¸¸è§çš„<strong>æ–‡æœ¬èŠ‚ç‚¹ä¸ä¼šæœ‰å­èŠ‚ç‚¹</strong></li></ul><ul id="139665fd-191c-435c-a483-1862fed2149f" class="bulleted-list"><li style="list-style-type:circle">ä¾‹å­å¦‚ä¸‹<pre id="43727185-3efd-432f-bf25-60e73c897703" class="code code-wrap"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((MutationRecords) =&gt;
  console.log(MutationRecords)
);

observer.observe(div, { characterData: true, subtree: true });
div.textContent = &quot;Hello&quot;;
div.appendChild(document.createTextNode(&quot;ä½ å¥½&quot;));
div.appendChild(document.createElement(&quot;p&quot;));
div.firstChild.data = &quot;KKK&quot;;
observer.disconnect();

observer.observe(div.firstChild, { characterData: true });
div.firstChild.textContent = &quot;KKK&quot;; // â‘ 
div.firstChild.data = &quot;SSS&quot;; // â‘¡
div.firstChild.nodeValue = &quot;RRR&quot;; // â‘¢
div.replaceChild(document.createTextNode(&quot;MMM&quot;), div.firstChild); // â‘£
div.firstChild.data = &quot;SSS&quot;; // â‘¤</code></pre><figure id="13ea5a74-5075-4b5b-a1d6-843a720672eb" class="image"><a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3/CharacterData.png"><img style="width:1175px" src="3%20MutationObserver%E6%8E%A5%E5%8F%A3/CharacterData.png"/></a></figure><ul id="fc1018d5-2c0c-4e43-b680-4732f1c4abb5" class="bulleted-list"><li style="list-style-type:square"><code>observer</code> å¯¹è±¡æœ¬æ¥æ³¨å†Œçš„è§‚å¯Ÿå¯¹è±¡æ˜¯<code>div</code>å…ƒç´ èŠ‚ç‚¹ï¼Œä½†æ˜¯å¯¹äº<code>div</code> åŠå…¶å­èŠ‚ç‚¹çš„ä¿®æ”¹å¹¶ä¸èƒ½å¼•èµ·ä»»ä½•çš„å˜åŒ–(<strong>Mutation</strong>)ï¼Œå› ä¸ºæ³¨å†Œæ—¶çš„<code>MutationObserverInit</code> å¯¹è±¡çš„è§‚å¯Ÿæ ‡å‡†æ˜¯<code>characterData</code> ç±»å‹ï¼Œæ‰€ä»¥<code>subtree</code> å¯¹å…¶æ— æ•ˆï¼Œè€Œ<code>div</code> åˆæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰è§¦å‘<code>observer</code> çš„å›è°ƒå‡½æ•°</li></ul><ul id="e2d67a88-889e-4850-b14f-c15f4e5479a0" class="bulleted-list"><li style="list-style-type:square">è€Œåè°ƒç”¨<code>disconnect()</code> æ³¨é”€äº†å¯¹<code>div</code> å…ƒç´ èŠ‚ç‚¹çš„è§‚å¯Ÿï¼Œå†æ³¨å†Œ<code>div</code> èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ä¸ºç›®æ ‡å¯¹è±¡ï¼Œä¹‹åå°±å¯ä»¥è§‚å¯Ÿæ–‡æœ¬èŠ‚ç‚¹çš„å†…å®¹</li></ul><ul id="6307c368-7c01-45fb-999f-b4d85d08d7c4" class="bulleted-list"><li style="list-style-type:square">æ“ä½œâ‘ â‘¡â‘¢å¯¹åº”å›è°ƒå‡½æ•°çš„å‚æ•°ä¸­ä¸‰ä¸ª<code>MutationRecord</code> å®ä¾‹çš„å˜åŒ–è®°å½•ï¼Œå®ƒä»¬çš„<code>type</code> éƒ½æ˜¯<code>characterData</code> è¿™æ˜¯ç”±æ³¨å†Œæ—¶çš„<code>MutationObserverInit</code> å¯¹è±¡å†³å®šï¼Œå› ä¸ºè§‚å¯Ÿçš„æ˜¯æ–‡æœ¬å†…å®¹ï¼Œæ‰€ä»¥<code>addedNodes</code> ã€<code>removedNodes</code> è‡ªç„¶æ˜¯ç©º<code>NodeList</code> ï¼Œ<code>nextSibling</code> ã€<code>previousSibling</code> è‡ªç„¶æ˜¯<code>null</code> ï¼Œ<code>target</code> æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œå³<code>div</code> çš„ç¬¬ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼›ä»ä¸­ä¹Ÿå¯ä»¥å‘ç°ï¼Œæ–‡æœ¬èŠ‚ç‚¹çš„<code>data</code>ï¼ˆ<code>CharacterData</code> æ¥å£å®šä¹‰ï¼‰ã€<code>nodeValue</code>ï¼ˆ<code>Node</code> æ¥å£å®šä¹‰ï¼‰ã€<code>textContent</code> ï¼ˆ<code>Node</code> æ¥å£å®šä¹‰ï¼‰å®é™…ä¸ŠæŒ‡çš„éƒ½æ˜¯æ–‡æœ¬å­—ç¬¦ä¸²</li></ul><ul id="018588a8-44e4-41ec-a1bf-77b1226ac494" class="bulleted-list"><li style="list-style-type:square">æ“ä½œâ‘£æ²¡æœ‰è§¦å‘å›è°ƒå‡½æ•°ï¼Œå› ä¸ºè°ƒç”¨<code>replaceChild()</code> æ›¿æ¢æ–‡æœ¬èŠ‚ç‚¹ä¸å±äºå¯¹è¢«è§‚å¯Ÿæ–‡æœ¬èŠ‚ç‚¹çš„å†…å®¹æ”¹å˜ï¼Œè€Œæ˜¯å¯¹<code>div</code> å…ƒç´ èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ”¹å˜ï¼Œå› ä¸ºè¢«è§‚å¯Ÿçš„æ–‡æœ¬èŠ‚ç‚¹å·²ä¸å†DOMæ ‘ä¸­ï¼Œæ“ä½œâ‘¤ä¹Ÿå°±æ˜¯ä¸æ˜¯å¯¹ç›®æ ‡æ–‡æœ¬èŠ‚ç‚¹çš„æ”¹å˜ï¼Œè€Œæ˜¯å¯¹æ›¿æ¢çš„æ–°æ–‡æœ¬èŠ‚ç‚¹çš„æ”¹å˜ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè§¦å‘å›è°ƒå‡½æ•°</li></ul></li></ul></li></ul><ul id="13bddd63-91e1-4184-ab1b-daaee6ef119b" class="bulleted-list"><li style="list-style-type:disc">å¯¹äº <code>attributeOldValue</code> å±æ€§ï¼Œéœ€è¦äº†è§£<ul id="1841f6a5-73d9-40cd-a8b9-cd0ac80ff50b" class="bulleted-list"><li style="list-style-type:circle">è®¾ç½®<code>attributeOldValue</code> ä¸º<code>true</code> ï¼Œé‚£ä¹ˆå°±ä¸ç”¨å…³å¿ƒ<code>attributes</code> çš„å€¼ï¼Œå®ƒè¦ä¹ˆä¸º<code>true</code> ï¼Œè¦ä¹ˆä¸è¿›è¡Œè®¾ç½®ï¼ˆå³è¢«è¿å¸¦ä¸º<code>true</code>ï¼‰ï¼Œå¦åˆ™ï¼ˆåœ¨<code>attributeOldValue</code> ä¸º<code>true</code> ï¼Œ<code>attributes</code> ä¸º<code>false</code> çš„æƒ…å†µä¸‹ï¼‰ä¼šæŠ›å‡ºå¼‚å¸¸<figure class="block-color-red_background callout" style="white-space:pre-wrap;display:flex" id="302a62e2-6f49-418b-997c-1aad3a17b952"><div style="font-size:1.5em"><span class="icon">ğŸ”´</span></div><div style="width:100%"><mark class="highlight-red">Uncaught TypeError: Failed to execute &#x27;observe&#x27; on &#x27;MutationObserver&#x27;: The options object may only set &#x27;attributeOldValue&#x27; to true when &#x27;attributes&#x27; is true or not present.</mark>
at 14.3.1.2 attributeOldValue.js:21:10</div></figure></li></ul><ul id="8b37b468-7f5a-4cbd-9629-031d6a95f916" class="bulleted-list"><li style="list-style-type:circle">è®¾ç½®<code>attributeOldValue</code> ä¸º<code>false</code> ï¼Œé‚£ä¹ˆ<code>attributes</code> çš„å€¼å†³å®šäº†æ˜¯å¦è§‚å¯Ÿæ³¨å†Œçš„ç›®æ ‡å¯¹è±¡çš„å±æ€§ï¼Œå¦‚æœè§‚å¯Ÿç›®æ ‡å¯¹è±¡çš„å±æ€§ï¼Œé‚£ä¹ˆ<code>oldValue</code> çš„å€¼ä¸€å®šæ˜¯<code>null</code> ï¼ˆå› ä¸ºä¸è®°å½•ä¸Šä¸€ä¸ªå±æ€§å€¼ï¼‰</li></ul><ul id="58ca73bd-ba7e-44ae-ae68-91c5ead96b1d" class="bulleted-list"><li style="list-style-type:circle"><code>attributeOldValue</code> é…åˆ <code>subtree</code> å¯ä»¥è¿å¸¦ç›®æ ‡èŠ‚ç‚¹çš„æ‰€æœ‰åä»£èŠ‚ç‚¹çš„å±æ€§å€¼éƒ½è¢«è§‚å¯Ÿï¼Œå¦‚ä¸‹æ˜¯ä¾‹å­<pre id="2d997ad7-5978-4c94-b9b8-64bf127738d9" class="code"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);

observer.observe(div, {
  subtree: true,
  attributeOldValue: true,
  attributes: true, // å¯ä»¥ä¸è®¾ç½®æˆ–è®¾ç½®æˆtrueï¼Œä½†ä¸èƒ½è®¾ç½®ä¸ºfalse
});

div.className = &quot;bar&quot;; // â‘ 
div.className = &quot;barz&quot;; // â‘¡

div.appendChild(document.createElement(&quot;p&quot;));
div.children[0].className = &quot;my-p&quot;; // â‘¢
div.children[0].className = &quot;my-p2&quot;; // â‘£</code></pre><figure id="7aefb083-8de5-4831-b6de-7acddeb2a6cd" class="image"><a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3/attributesOldValue.png"><img style="width:2109px" src="3%20MutationObserver%E6%8E%A5%E5%8F%A3/attributesOldValue.png"/></a></figure><ul id="d73e899a-b6d6-4709-9ad8-217f7bae4c06" class="bulleted-list"><li style="list-style-type:square">ç¬¬ä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹ç”±æ“ä½œâ‘ å¼•èµ·ï¼Œå› ä¸ºæ˜¯é¦–æ¬¡ä¿®æ”¹<code>class</code> ä¸å­˜åœ¨ä¸Šä¸€ä¸ªç±»åç§°ï¼Œæ‰€ä»¥<code>oldValue</code> ä¸º<code>null</code> </li></ul><ul id="e3479072-ba76-4087-93a5-2477f9f249db" class="bulleted-list"><li style="list-style-type:square">ç¬¬äºŒä¸ª<code>MutationRecord</code> å®ä¾‹ç”±æ“ä½œâ‘¡å¼•èµ·ï¼Œæœ¬æ¥çš„ç±»åå°±æ˜¯ä¸Šä¸€ä¸ªæ“ä½œï¼ˆâ‘ ï¼‰è®¾ç½®çš„ç±»åç§°ï¼Œæ‰€ä»¥<code>oldValue</code> ä¸º<code>bar</code></li></ul><ul id="8e38f65f-5d75-4a69-8426-dd1ddf4abee4" class="bulleted-list"><li style="list-style-type:square">ç¬¬ä¸‰ä¸ª<code>MutationRecord</code> å®ä¾‹ç”±æ“ä½œâ‘¢å¼•èµ·ï¼Œå®ƒæ˜¯ç›®æ ‡å¯¹è±¡çš„åä»£èŠ‚ç‚¹ï¼ˆ<code>p</code>ï¼‰çš„å±æ€§äº§ç”Ÿçš„<strong>å˜åŒ–</strong>ï¼Œ<code>target</code> ä¸º<code>p</code> å…ƒç´ èŠ‚ç‚¹ï¼Œå› ä¸ºæ˜¯é¦–æ¬¡ä¿®æ”¹<code>class</code> ï¼Œæ‰€ä»¥<code>oldValue</code> ä¸º<code>null</code></li></ul><ul id="a847ac4d-778c-4dce-9e7b-7d46e7785caa" class="bulleted-list"><li style="list-style-type:square">ç¬¬å››ä¸ª<code>MutationRecord</code> å®ä¾‹ç”±æ“ä½œâ‘£å¼•èµ·ï¼Œå®ƒæ˜¯ä¸Šä¸€ä¸ªæ“ä½œçš„<code>p</code> å…ƒç´ èŠ‚ç‚¹ä¿®æ”¹<code>className</code> çš„å˜åŒ–ï¼Œæ‰€ä»¥<code>oldValue</code> ä¸º <code>my-p</code> </li></ul></li></ul></li></ul><h2 id="ea3bcce5-8985-4194-bc83-efaf72d7fcbe" class="">3.1.3 disconnect()æ–¹æ³•</h2><ul id="ddd1bb00-853c-47dc-83a3-cd27b7711676" class="bulleted-list"><li style="list-style-type:disc">ä½¿ç”¨<code>observe()</code> æ³¨å†Œè¢«è§‚å¯Ÿçš„èŠ‚ç‚¹å’Œè§‚å¯Ÿæ ‡å‡†åï¼Œåªè¦èŠ‚ç‚¹ä¸è¢«åƒåœ¾å›æ”¶ï¼Œ<code>MutationObserver</code> å®ä¾‹çš„å›è°ƒå°±ä¼šå“åº”DOMå˜åŒ–äº‹ä»¶</li></ul><ul id="576d77ed-ff05-4e26-8746-dd9744f76d76" class="bulleted-list"><li style="list-style-type:disc">è¦æ³¨é”€<code>MutationObserver</code> æ³¨å†Œçš„è¢«è§‚å¯ŸèŠ‚ç‚¹ï¼Œå¯ä»¥è°ƒç”¨<code>disconnect()</code> æ–¹æ³•<ul id="114ba038-2afd-4d31-bbb2-44accb805593" class="bulleted-list"><li style="list-style-type:circle"><code>disconnect()</code> æ˜¯åŒæ­¥æ–¹æ³•ï¼Œæ‰€ä»¥æ‰§è¡Œåä¸ä»…ä¼šåœæ­¢æ­¤åå˜åŒ–äº‹ä»¶çš„å›è°ƒï¼Œä¹Ÿä¼š<strong>æŠ›å¼ƒå·²åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—è¦å¼‚æ­¥æ‰§è¡Œçš„å›è°ƒ</strong></li></ul><ul id="834f67a2-ea40-498b-9c61-b5e57853747e" class="bulleted-list"><li style="list-style-type:circle">æƒ³è¦è®©å·²åŠ å…¥çš„ä»»åŠ¡é˜Ÿåˆ—çš„å›è°ƒæ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨<code>setTimeout()</code> è®©å·²ç»å…¥åˆ—çš„å›è°ƒæ‰§è¡Œå®Œæ¯•å†è°ƒç”¨<code>disconnect()</code> </li></ul><pre id="045b3cd2-0bc1-4cc1-8569-d0d0ca9e6046" class="code"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);

observer.observe(div, { attributes: true });

div.className = &quot;foo&quot;;
observer.disconnect();
div.className = &quot;bar&quot;;
// ä¸ä¼šæœ‰ä»»ä½•æ‰“å°</code></pre><pre id="335cb68b-b131-41fa-81d2-17bc7ae4d642" class="code"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);

observer.observe(div, { attributes: true });

div.className = &quot;foo&quot;; // æ“ä½œâ‘ 
setTimeout(() =&gt; {
  observer.disconnect();
  div.className = &quot;bar&quot;; // æ“ä½œâ‘¡
});
// æ‰“å°
[MutationRecord] {
	0: MutationRecord {type: &#x27;attributes&#x27;, target: div.bar, addedNodes: NodeList(0), removedNodes: NodeList(0), previousSibling: null, â€¦}
	length :1
}</code></pre><ul id="2d287432-5039-4b67-996c-4ef51892c57d" class="bulleted-list"><li style="list-style-type:circle">ä½¿ç”¨<code>setTimeout()</code> åï¼Œæ“ä½œâ‘ è§¦å‘çš„å˜åŒ–äº‹ä»¶ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œä½†æ˜¯æ“ä½œâ‘¡è§¦å‘çš„å˜åŒ–äº‹ä»¶ä¼šè¢«åœæ­¢</li></ul></li></ul><h2 id="22737abb-1a3e-4d74-b901-05ef16ae0f3a" class="">3.1.4 å¤ç”¨MutationObserverï¼ˆMultiplexing a MuatationObserverï¼‰</h2><ul id="ecd8e84b-f49c-4eec-9b58-de55613b0af0" class="bulleted-list"><li style="list-style-type:disc">ä¸€ä¸ª<code>MuattionObserver</code> å¯¹è±¡å¯ä»¥åŒæ—¶è§‚å¯Ÿå¤šä¸ªä¸åŒçš„ç›®æ ‡èŠ‚ç‚¹ï¼Œåªè¦å¤šæ¬¡è°ƒç”¨<code>observe()</code> æ–¹æ³•æ—¶ä¼ å…¥ä¸åŒçš„ç›®æ ‡èŠ‚ç‚¹å³å¯ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°ä¸­çš„<code>MutationRecord</code> å®ä¾‹çš„<code>target</code> å±æ€§ä¼šä¿å­˜å˜åŒ–çš„ç›®æ ‡èŠ‚ç‚¹</li></ul><ul id="8579b1f8-8d87-4891-a702-f2cc1839ecb8" class="bulleted-list"><li style="list-style-type:disc">è€Œ<code>disconnect()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªâ€œä¸€åˆ€åˆ‡â€æ–¹æ¡ˆï¼Œè°ƒç”¨å®ƒä¼šåœæ­¢è§‚å¯Ÿæ‰€æœ‰ç›®æ ‡</li></ul><ul id="595e95e2-3ab9-4363-9f6f-726042b41be1" class="bulleted-list"><li style="list-style-type:disc">å³ä½¿åŒæ—¶è§‚å¯Ÿå¤šä¸ªä¸åŒçš„ç›®æ ‡èŠ‚ç‚¹ï¼Œå›è°ƒå‡½æ•°å‚æ•°ä¸­çš„<code>MutationRecord</code> å®ä¾‹æ•°ç»„ä¸­çš„é¡ºåºä¹Ÿæ˜¯æŒ‰ç…§<strong>å˜åŒ–</strong>å‘ç”Ÿçš„é¡ºåºæ’åˆ—çš„<pre id="224deea3-338f-4659-bbcb-2eaac4747cae" class="code"><code>const div = document.querySelector(&quot;div&quot;);
const p = document.querySelector(&quot;p&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);
observer.observe(div, { attributes: true });
observer.observe(p, { attributes: true });
p.className = &quot;bar&quot;;
div.className = &quot;foo&quot;;

setTimeout(() =&gt; {
  observer.disconnect();
  p.className = &quot;bar2&quot;;
  div.className = &quot;foo2&quot;;
});

// æ‰“å°
// [MutationRecord, MutationRecord]</code></pre></li></ul><h2 id="f445a238-0b7b-4559-85cd-f8250cbf2e63" class="">3.1.5 é‡ç”¨MutationObserverï¼ˆReusing a MutationObserverï¼‰</h2><ul id="f49182ac-5fba-4083-8b6a-7dbe1dab34bc" class="bulleted-list"><li style="list-style-type:disc">è°ƒç”¨<code>disconnect()</code> å¹¶ä¸ä¼šç»“æŸ<code>MutationObserver</code> çš„ç”Ÿå‘½ï¼Œè¿˜å¯ä»¥é‡æ–°ä½¿ç”¨è¿™ä¸ªè§‚å¯Ÿè€…ï¼Œåªéœ€è¦å†è°ƒç”¨<code>observe()</code> æŠŠå®ƒå…³è”åˆ°æ–°çš„ç›®æ ‡èŠ‚ç‚¹å°±è¡Œ</li></ul><ul id="76cacf37-855a-43df-8464-46b7af7a6da3" class="bulleted-list"><li style="list-style-type:disc">å› ä¸º<code>observe()</code> å’Œ<code>disconnect()</code> éƒ½æ˜¯åŒæ­¥çš„ï¼Œè°ƒç”¨åå°±ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè€Œäº§ç”Ÿçš„å˜åŒ–äº‹ä»¶å»è°ƒç”¨å¼‚æ­¥å‡½æ•°åˆæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥<code>disconnect()</code> ä¼šæ— æ•ˆåœ¨è°ƒç”¨å®ƒä¹‹å‰åˆ°ä¸‹ä¸€ä¸ª<code>observe()</code> è°ƒç”¨ä¹‹å‰çš„æ‰€æœ‰å˜åŒ–äº‹ä»¶<pre id="d536cd62-887f-4048-92c7-a2574e280d5c" class="code"><code>const p = document.querySelector(&quot;p&quot;);
const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);

observer.observe(p, { attributes: true }); // å¼€å§‹
p.className = &quot;bar&quot;;

observer.disconnect();

p.className = &quot;bar2&quot;;
p.className = &quot;bar3&quot;;
observer.observe(p, { attributes: true }); // ç»“æŸ  -&gt;è¿™ä¸€æ®µçš„å±æ€§å˜åŒ–äº‹ä»¶æ— æ•ˆ

p.className = &quot;bar4&quot;;

// æ‰“å°
// [MutationRecord]</code></pre></li></ul><h1 id="a20322ac-5a5d-414e-85a6-0819b03abd67" class="">3.2 MutationObserverInitä¸è§‚å¯ŸèŒƒå›´ï¼ˆControlling the Observer scope with MutationObserverInitï¼‰</h1><ul id="e0a9ddb6-5955-4670-9ac3-b8b3035e33a2" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserverInit</code> å¯¹è±¡ç”¨äº<a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3.html">æ§åˆ¶å¯¹ç›®æ ‡èŠ‚ç‚¹çš„è§‚å¯ŸèŒƒå›´</a> ã€‚è§‚å¯Ÿè€…å¯ä»¥è§‚å¯Ÿçš„å˜åŒ–åŒ…æ‹¬å±æ€§å˜åŒ–ï¼ˆ<code>attributes</code>ï¼‰ï¼Œæ–‡æœ¬å˜åŒ–ï¼ˆ<code>characterData</code>ï¼‰ï¼Œå­èŠ‚ç‚¹å˜åŒ–ï¼ˆ<code>childList</code>ï¼‰</li></ul><ul id="5be36885-abbf-4b87-9023-53422a6ac465" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserverInit</code> å¯¹è±¡çš„å±æ€§å¦‚ä¸‹è¡¨<table id="8e3f3910-b5c5-4a51-8e37-6d635c51ef92" class="simple-table"><tbody><tr id="1c801140-aec0-463e-b37b-903d13b8e7bb"><td id="[pmC" class="">å±æ€§</td><td id="sFU\" class="" style="width:464px">è¯´æ˜</td></tr><tr id="c0a1a1ee-ec2b-4330-96d5-4d4b9e3d5916"><td id="[pmC" class="">subtree</td><td id="sFU\" class="" style="width:464px">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºé™¤äº†ç›®æ ‡èŠ‚ç‚¹ï¼Œæ˜¯å¦è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹çš„å­æ ‘ï¼ˆåä»£ï¼‰ï¼›å¦‚æœæ˜¯<code>false</code> åˆ™åªè§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹çš„å˜åŒ–ï¼›å¦‚æœæ˜¯<code>true</code> åˆ™è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹åŠå…¶æ•´ä¸ªå­æ ‘ï¼›é»˜è®¤ä¸º<code>false</code> </td></tr><tr id="eef69489-69dc-42be-84c9-7dbe04432036"><td id="[pmC" class="">attributes</td><td id="sFU\" class="" style="width:464px">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹çš„å±æ€§å˜åŒ–ï¼›é»˜è®¤ä¸º<code>false</code></td></tr><tr id="fc3922ed-27a4-4ac6-b4bb-59d1ed013829"><td id="[pmC" class="">attributeFilter</td><td id="sFU\" class="" style="width:464px">å­—ç¬¦ä¸²æ•°ç»„ï¼Œè¡¨ç¤ºè¦è§‚å¯Ÿå“ªäº›å±æ€§çš„å˜åŒ–ï¼›æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º<code>true</code> ä¹Ÿä¼šå°†<code>attributes</code> çš„å€¼è½¬æ¢ä¸º<code>true</code> ï¼›é»˜è®¤å€¼ä¸ºè§‚å¯Ÿæ‰€æœ‰å±æ€§</td></tr><tr id="7f3a9cfe-3ce5-4281-ab95-0b834b1b7ed2"><td id="[pmC" class="">attributeOldValue</td><td id="sFU\" class="" style="width:464px">å¸ƒå°”å€¼ï¼Œè¡¨ç¤º<code>MutationRecord</code> æ˜¯å¦è®°å½•å˜åŒ–ä¹‹å‰çš„å±æ€§å€¼ï¼ŒæŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º<code>true</code> ä¹Ÿä¼šå°†<code>attributes</code> çš„å€¼è½¬æ¢ä¸º<code>true</code> ï¼Œé»˜è®¤ä¸º<code>false</code> </td></tr><tr id="5bb13989-d87a-4424-bd0b-0d3414173a92"><td id="[pmC" class="">characterData</td><td id="sFU\" class="" style="width:464px">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä¿®æ”¹å­—ç¬¦æ•°æ®æ˜¯å¦è§¦å‘äº‹ä»¶ï¼›é»˜è®¤ä¸º<code>false</code> </td></tr><tr id="49e490b4-e6f0-4d1e-b46d-8c54f4396de6"><td id="[pmC" class="">characterDataOldValue</td><td id="sFU\" class="" style="width:464px">å¸ƒå°”å€¼ï¼Œè¡¨ç¤º<code>MutationRecord</code> æ˜¯å¦è®°å½•å˜åŒ–ä¹‹å‰çš„å­—ç¬¦æ•°æ®ï¼›æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º<code>true</code> ä¹Ÿä¼šå°†<code>characterData</code> çš„å€¼è½¬æ¢ä¸º<code>true</code> ï¼Œé»˜è®¤ä¸º<code>false</code></td></tr><tr id="f6a2f125-11eb-496b-ad38-4b290673fe0f"><td id="[pmC" class="">childList</td><td id="sFU\" class="" style="width:464px">å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä¿®æ”¹ç›®æ ‡èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯å¦è§¦å‘å˜åŒ–äº‹ä»¶ï¼›é»˜è®¤ä¸º<code>false</code> </td></tr></tbody></table></li></ul><figure class="block-color-blue_background callout" style="white-space:pre-wrap;display:flex" id="0f2ceb69-ebdb-45c3-8c27-3cb18c800b71"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">æ³¨æ„ï¼šåœ¨è°ƒç”¨<code>observe()</code>æ—¶ï¼Œ<code>MutationObserverInit</code> å¯¹è±¡ä¸­çš„<code>attributes</code> ã€<code>characterData</code> ã€<code>childList</code> å±æ€§å¿…é¡»è‡³å°‘æœ‰ä¸€é¡¹ä¸º<code>true</code> ï¼ˆæ— è®ºæ˜¯ç›´æ¥è®¾ç½®è¿™å‡ ä¸ªå±æ€§ï¼Œè¿˜æ˜¯é€šè¿‡è®¾ç½®<code>attributeOldValue</code> ç­‰å±æ€§é—´æ¥å¯¼è‡´å®ƒä»¬çš„å€¼è½¬æ¢ä¸º<code>true</code>ï¼‰ã€‚å¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•å˜åŒ–äº‹ä»¶å¯èƒ½è§¦å‘å›è°ƒ</div></figure><h2 id="32d51b07-daa7-434c-a2cc-404d022ca159" class="">3.2.1 è§‚å¯Ÿå±æ€§</h2><ul id="10b3a3e7-6ec2-4b27-a7b1-40d5520b0edc" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserver</code> å¯ä»¥è§‚å¯ŸèŠ‚ç‚¹å±æ€§çš„<strong>æ·»åŠ ã€ç§»é™¤å’Œä¿®æ”¹</strong>ï¼Œè¦ä¸ºå±æ€§å˜åŒ–æ³¨å†Œå›è°ƒï¼Œéœ€è¦åœ¨<code>MutationObserverInit</code> å¯¹è±¡å°†<code>attributes</code> å±æ€§è®¾ç½®ä¸º<code>true</code> å³å¯</li></ul><ul id="a089b978-bdea-432c-ab2b-d1909cd07950" class="bulleted-list"><li style="list-style-type:disc">æŠŠ<code>attributes</code> è®¾ç½®ä¸º<code>true</code> çš„é»˜è®¤è¡Œä¸ºæ˜¯è§‚å¯Ÿæ‰€æœ‰å±æ€§ï¼Œä½†ä¸ä¼šåœ¨<code>MutationRecord</code> å¯¹è±¡ä¸­è®°å½•åŸæ¥çš„å±æ€§å€¼ã€‚<ul id="d5d5e41b-670e-4e57-9db7-a9eea736f067" class="bulleted-list"><li style="list-style-type:circle">å¦‚æœæƒ³è¦è§‚å¯ŸæŸä¸ªæˆ–ä¸€äº›å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨<code>attributeFilter</code> å±æ€§æ¥è®¾ç½®ç™½åå•ï¼Œå³ä¸€ä¸ªå±æ€§åå­—ç¬¦ä¸²æ•°æ®</li></ul><ul id="485b6228-a678-4c28-baf6-231011541a98" class="bulleted-list"><li style="list-style-type:circle">å¦‚æœæƒ³è¦è®°å½•å±æ€§å˜åŒ–çš„å‰ä¸€ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>attributeOldValue</code> æ¥æŒ‡ç¤ºè®°å½•å‰ä¸€ä¸ªå±æ€§å€¼</li></ul></li></ul><ul id="cee6b27a-3bf2-4c20-b15b-b9887b7b10b6" class="bulleted-list"><li style="list-style-type:disc">è§‚å¯Ÿå±æ€§çš„ä¾‹å­å¯ä»¥æŸ¥çœ‹ <a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3.html">example</a></li></ul><h2 id="5e669da9-94a7-4e69-922f-5d51d67eb18b" class="">3.2.2 è§‚å¯Ÿå­—ç¬¦æ•°æ®</h2><ul id="1adbf408-f28e-46d5-9141-4e6860634f94" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserver</code> å¯ä»¥è§‚å¯Ÿæ–‡æœ¬èŠ‚ç‚¹ï¼ˆå¦‚Textï¼ŒCommentå’ŒProcessingInstructionèŠ‚ç‚¹ï¼‰ä¸­å­—ç¬¦ï¼ˆdataï¼‰çš„æ·»åŠ ã€åˆ é™¤ä¿®æ”¹ï¼Œè¦ä¸ºå­—ç¬¦æ•°æ®æ³¨å†Œå›è°ƒï¼Œéœ€è¦åœ¨<code>MutationObserverInit</code> å¯¹è±¡ä¸­å°†<code>characterData</code>å±æ€§è®¾ç½®ä¸º<code>true</code></li></ul><ul id="493a3e46-7e7a-4624-aefa-8afbf2bc9358" class="bulleted-list"><li style="list-style-type:disc">å°†<code>characterData</code> å±æ€§è®¾ç½®ä¸º<code>true</code> çš„é»˜è®¤è¡Œä¸ºä¸ä¼šåœ¨<code>MutationRecord</code> å¯¹è±¡è®°å½•åŸæœ¬çš„å­—ç¬¦æ•°æ®ï¼Œå¦‚æœæƒ³è¦åœ¨å˜åŒ–è®°å½•ä¸­ä¿å­˜åŸæ¥çš„å­—ç¬¦æ•°æ®ï¼Œå¯ä»¥å°†<code>characterDataOldValue</code> å±æ€§è®¾ç½®ä¸º<code>true</code> </li></ul><ul id="39afd8f6-4707-4180-b222-41ea03fc4b9b" class="bulleted-list"><li style="list-style-type:disc">è§‚å¯Ÿå­—ç¬¦æ•°æ®çš„ä¾‹å­å¯ä»¥æŸ¥çœ‹<a href="3%20MutationObserver%E6%8E%A5%E5%8F%A3.html">example</a></li></ul><h2 id="78055929-c745-422a-9fb0-119fa37c8e14" class="">3.2.3 è§‚å¯Ÿå­èŠ‚ç‚¹</h2><ul id="be609cde-dc74-48a5-919b-068682f44345" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserver</code> å¯ä»¥è§‚å¯Ÿç›®æ ‡èŠ‚ç‚¹å­èŠ‚ç‚¹çš„æ·»åŠ å’Œç§»é™¤ï¼Œè¦è§‚å¯Ÿå­èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨<code>MutationObserverInit</code> å¯¹è±¡ä¸­å°†<code>childList</code> å±æ€§è®¾ç½®ä¸º<code>true</code> </li></ul><ul id="a323c93a-f3b9-455b-9f6e-137862b4e4f7" class="bulleted-list"><li style="list-style-type:disc">å¯¹å­èŠ‚ç‚¹çš„<strong>é‡æ–°æ’åºï¼ˆ</strong>å°½ç®¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å³å¯å®ç°<strong>ï¼‰</strong>ä¼šæŠ¥å‘Šä¸¤æ¬¡å˜åŒ–äº‹ä»¶ï¼Œå› ä¸ºä»æŠ€æœ¯ä¸Šä¼šæ¶‰åŠå…ˆç§»é™¤å’Œå†æ·»åŠ <ul id="a15167e7-b179-4d5b-ba59-12e96d47533d" class="bulleted-list"><li style="list-style-type:circle">æœ€ç®€å•çš„æ’åºå°±æ˜¯ä½¿ç”¨<code>insertBefore()</code> æ–¹æ³•å°†ä¸¤ä¸ªå·²ç»å­˜åœ¨çš„å­èŠ‚ç‚¹æ”¹å˜ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å°†å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é¢</li></ul><ul id="54ce720b-def9-4734-8dd6-8cbad6dc3430" class="bulleted-list"><li style="list-style-type:circle">è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªå˜åŒ–ï¼Œå‡è®¾ç§»åŠ¨ä½ç½®çš„èŠ‚ç‚¹ä¸º<code>node1</code> ï¼Œé‚£ä¹ˆå…ˆè¦å°†ä»–ä»ç›®æ ‡èŠ‚ç‚¹ä¸­ç§»é™¤ï¼Œç§»é™¤ä¼šè§¦å‘ä¸€æ¬¡å˜åŒ–äº‹ä»¶ï¼Œå¯¹åº”çš„<code>MutationRecord</code> å®ä¾‹çš„<code>removedNodes</code> åŒ…å«<code>node1</code> ï¼Œ<code>nextSibling</code> å’Œ<code>previousSibling</code> å°±æ˜¯<code>node1</code> èŠ‚ç‚¹çš„å‰åç›¸é‚»èŠ‚ç‚¹ï¼›å‡è®¾å‚è€ƒä½ç½®çš„èŠ‚ç‚¹ä¸º<code>node2</code> ï¼Œé‚£ä¹ˆå°†<code>node1</code> æ’å…¥åˆ°<code>node2</code> èŠ‚ç‚¹å‰ç›¸å½“äºä¸€æ¬¡æ·»åŠ å˜åŒ–ï¼Œå¯¹åº”çš„<code>MutationRecord</code> å®ä¾‹çš„<code>addedNodes</code> åŒ…å«<code>node1</code> ï¼Œ<code>nextSibling</code> å’Œ<code>previousSibling</code>å°±æ˜¯<code>node1</code> èŠ‚ç‚¹æ’å…¥åçš„å‰åç›¸é‚»èŠ‚ç‚¹</li></ul></li></ul><ul id="cd12212b-efd8-4d7d-bafb-f7db4ebf918d" class="bulleted-list"><li style="list-style-type:disc">ä½¿ç”¨<code>inserBefore()</code> è¿›è¡Œæ’åºçš„ä¾‹å­å¦‚ä¸‹<pre id="de5ee832-2e4c-4165-b638-18d290e5f6c7" class="code code-wrap"><code>&lt;div&gt;
  &lt;p&gt;1&lt;/p&gt;
  &lt;p&gt;2&lt;/p&gt;
  &lt;p&gt;3&lt;/p&gt;
&lt;/div&gt;
-----------------------
const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);

observer.observe(div, { childList: true });

div.insertBefore(div.lastElementChild, div.firstElementChild);
// æ‰“å°
// [MutationRecord, MutationRecord]</code></pre></li></ul><h2 id="7d069d70-03ca-45de-8faa-165e29ac8cc3" class="">3.2.4 è§‚å¯Ÿå­æ ‘</h2><ul id="f99cb939-ba3f-43c5-8fdb-d57006979c95" class="bulleted-list"><li style="list-style-type:disc">é»˜è®¤æƒ…å†µä¸‹ï¼ŒMutationObserverå°†è§‚å¯Ÿçš„èŒƒå›´é™å®šä¸ºä¸€ä¸ªå…ƒç´ åŠå…¶å­èŠ‚ç‚¹çš„å˜åŒ–ï¼Œè¦æŠŠè§‚å¯ŸèŒƒå›´æ‰©å±•åˆ°è¿™ä¸ªå…ƒç´ çš„å­æ ‘ï¼ˆæ‰€æœ‰åä»£èŠ‚ç‚¹ï¼‰ï¼Œè¿™éœ€è¦åœ¨<code>MutationObserverInit</code> å¯¹è±¡ä¸­å°†<code>subtree</code> å±æ€§è®¾ç½®ä¸º<code>true</code> </li></ul><ul id="6ec8c780-a80e-43d8-ad85-f40c1343974e" class="bulleted-list"><li style="list-style-type:disc">è¢«è§‚å¯Ÿçš„å­æ ‘ä¸­çš„èŠ‚ç‚¹<strong>è¢«ç§»å‡ºå­æ ‘ä¹‹åä»ç„¶èƒ½è§¦å‘å˜åŒ–äº‹ä»¶</strong>ï¼Œè¿™æ„å‘³ç€åœ¨æ—¶é—´ç»´åº¦ä¸Šï¼Œæ›¾ç»åœ¨è¿‡å­æ ‘ä¸Šçš„èŠ‚ç‚¹éƒ½èƒ½è§¦å‘å˜åŒ–äº‹ä»¶ï¼Œé™¤éè¿™ä¸ªèŠ‚ç‚¹è¢«åƒåœ¾å›æ”¶<pre id="9c2e135f-d708-4b61-bb2f-3c7651a7786e" class="code code-wrap"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);
const p = document.createElement(&quot;p&quot;);
div.appendChild(p);

observer.observe(div, { childList: true, subtree: true });

div.removeChild(p); // åˆ é™¤èŠ‚ç‚¹ï¼Œè§¦å‘å˜åŒ–äº‹ä»¶

p.textContent = &quot;Hello&quot;; // è¢«åˆ é™¤èŠ‚ç‚¹ä¹Ÿä¼šè§¦å‘å˜åŒ–äº‹ä»¶

// æ‰“å°
// [MutationRecord, MutationRecord]</code></pre></li></ul><h1 id="38197e37-48c7-4f2a-894a-db9b9ea15041" class="">3.3 å¼‚æ­¥å›è°ƒä¸è®°å½•é˜Ÿåˆ—ï¼ˆAsync Callbacks and Record Queueï¼‰</h1><ul id="e4c2b82f-2173-4b23-863c-8a8c2312fdc5" class="bulleted-list"><li style="list-style-type:disc"><code>MutationObserver</code> æ¥å£çš„æ ¸å¿ƒæ˜¯<strong>å¼‚æ­¥å›è°ƒ</strong>ä¸<strong>è®°å½•é˜Ÿåˆ—</strong>æ¨¡å‹ï¼Œè¿™æ ·è®¾è®¡æ˜¯å‡ºäº<strong>æ€§èƒ½</strong>è€ƒè™‘<ul id="949af7b8-8dbe-4e7c-886a-f5c2f7728240" class="bulleted-list"><li style="list-style-type:circle">ä¸ºäº†åœ¨å¤§é‡å˜åŒ–äº‹ä»¶å‘ç”Ÿæ—¶ä¸å½±å“æ€§èƒ½ï¼Œæ¯æ¬¡å˜åŒ–çš„ä¿¡æ¯ï¼ˆç”±è§‚å¯Ÿè€…å®ä¾‹å†³å®šï¼‰ä¼šä¿å­˜åœ¨<code>MutationRecord</code> å®ä¾‹ä¸­ï¼Œç„¶åå®ä¾‹è¢«æ·»åŠ åˆ°<strong>è®°å½•é˜Ÿåˆ—</strong></li></ul><ul id="e5a49682-e46b-419b-8383-9bd59771ebe9" class="bulleted-list"><li style="list-style-type:circle">è¿™ä¸ªé˜Ÿåˆ—å¯¹æ¯ä¸ª<code>MutationObserver</code> å®ä¾‹éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ˜¯æ‰€æœ‰DOMå˜åŒ–äº‹ä»¶çš„æœ‰åºåˆ—è¡¨</li></ul></li></ul><h2 id="ffb74362-7024-4eb4-801f-03969127c444" class="">3.3.1 è®°å½•é˜Ÿåˆ—çš„è¡Œä¸º</h2><ul id="0c1f141f-f322-4be5-9475-245c9f2e0fb4" class="bulleted-list"><li style="list-style-type:disc">æ¯æ¬¡<code>MutationRecord</code> è¢«æ·»åŠ åˆ°<code>MutationObserver</code> çš„è®°å½•é˜Ÿåˆ—æ—¶ï¼Œä»…å½“ä¹‹å‰æ²¡æœ‰å·²æ’æœŸçš„å¾®ä»»åŠ¡å›è°ƒæ—¶ï¼ˆé˜Ÿåˆ—ä¸­å¾®ä»»åŠ¡é•¿åº¦ä¸º0ï¼‰ï¼Œæ‰ä¼šå°†è§‚å¯Ÿè€…æ³¨å†Œçš„å›è°ƒï¼ˆåœ¨åˆå§‹åŒ–<code>MutationObserver</code>æ—¶ä¼ å…¥ï¼‰ä½œä¸ºå¾®ä»»åŠ¡è°ƒåº¦åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸Šï¼Œè¿™æ ·å¯ä»¥ä¿è¯è®°å½•é˜Ÿåˆ—çš„å†…å®¹ä¸ä¼šè¢«å›è°ƒå¤„ç†ä¸¤æ¬¡<ul id="a69f272f-fc18-4f8a-8051-5980132c5c2c" class="bulleted-list"><li style="list-style-type:circle"><strong>å¾®ä»»åŠ¡</strong>ï¼ˆ<strong>microtask</strong>ï¼‰ï¼Œç»„æˆä»»åŠ¡çš„æ›´å°éƒ¨åˆ†</li></ul><ul id="f614cfc0-169b-4f4e-80b9-c095a7ffd15c" class="bulleted-list"><li style="list-style-type:circle">ä¸Šé¢çš„æ˜¯ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹çš„åŸè¯ï¼Œä¸ºäº†è¡¨ç¤ºå¤šä¸ªå¾®ä»»åŠ¡å›è°ƒåº”è¯¥ç»„åˆæˆä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·å°±åªéœ€è°ƒç”¨ä¸€æ¬¡å›è°ƒï¼Œè€Œä¸éœ€è¦å¤šæ¬¡è°ƒç”¨å›è°ƒ</li></ul></li></ul><ul id="9edf7e91-912b-42cd-a792-cd815bac05ad" class="bulleted-list"><li style="list-style-type:disc">ä¸è¿‡åœ¨å›è°ƒçš„å¾®ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œçš„æœŸé—´ï¼Œæœ‰å¯èƒ½åˆå‘ç”Ÿæ›´å¤šå˜åŒ–äº‹ä»¶ï¼Œå› æ­¤è¢«è°ƒç”¨çš„å›è°ƒä¼šæ¥æ”¶åˆ°ä¸€ä¸ª<code>MutationRecord</code> å®ä¾‹çš„æ•°ç»„ï¼Œé¡ºåºä¸ºå®ƒä»¬è¿›å…¥è®°å½•é˜Ÿåˆ—çš„é¡ºåºï¼Œå›è°ƒè¦è´Ÿè´£å¤„ç†è¿™ä¸ªæ•°ç»„çš„æ¯ä¸€ä¸ªå®ä¾‹ï¼Œå› ä¸ºå‡½æ•°é€€å‡ºä¹‹åè¿™äº›å®ç°ï¼ˆ<strong>persist</strong>ï¼‰å°±ä¸å­˜åœ¨äº†ã€‚å›è°ƒæ‰§è¡Œåï¼Œè¿™äº›<code>MutationRecord</code> å°±ç”¨ä¸ç€äº†ï¼Œå› æ­¤è®°å½•é˜Ÿåˆ—ä¼šè¢«æ¸…ç©ºï¼Œå…¶å†…å®¹ä¼šè¢«ä¸¢å¼ƒ</li></ul><h2 id="c5ccb941-4251-440a-b9f9-719a32bc4bbf" class="">3.3.2 takeRecords()æ–¹æ³•</h2><ul id="ba1b0b1a-b93c-4e08-87b6-f66bcf2dd5de" class="bulleted-list"><li style="list-style-type:disc">è°ƒç”¨<code>MutationObserver</code> å®ä¾‹çš„<code>takeRecords()</code> æ–¹æ³•å¯ä»¥æ¸…ç©ºè®°å½•é˜Ÿåˆ—ï¼Œå–å‡ºå¹¶è¿”å›å…¶ä¸­çš„æ‰€æœ‰<code>MutationRecord</code> å®ä¾‹</li></ul><ul id="91e1633a-e965-4105-af13-269e16a592b9" class="bulleted-list"><li style="list-style-type:disc">è¿™æ˜¯å¸Œæœ›<strong>æ–­å¼€ä¸è§‚å¯Ÿç›®æ ‡çš„è”ç³»</strong>ï¼Œä½†åˆå¸Œæœ›å¤„ç†ç”±äºè°ƒç”¨disconnect()è€Œè¢«æŠ›å¼ƒçš„è®°å½•é˜Ÿåˆ—ä¸­çš„<code>MutationRecord</code> å®ä¾‹æ—¶æ¯”è¾ƒæœ‰ç”¨<ul id="0342743d-285c-426b-aea7-f63867328a27" class="bulleted-list"><li style="list-style-type:circle">ä¸Šé¢çš„æ˜¯ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹çš„åŸè¯</li></ul><ul id="8eefab37-ce94-455b-bf79-e92047dae76f" class="bulleted-list"><li style="list-style-type:circle">å› ä¸º<code>takeRecords()</code> æ˜¯åŒæ­¥å‡½æ•°ï¼Œæ‰€ä»¥ä¸€æ—¦æ‰§è¡Œï¼Œå·²ç»è®°å½•çš„å˜åŒ–å¯¹åº”çš„<code>MutationRecord</code> ä¼šä»è®°å½•é˜Ÿåˆ—ä¸­è¢«å–å‡º</li></ul><ul id="c7f0c538-acf9-4b72-a898-f7e7ed05a5f5" class="bulleted-list"><li style="list-style-type:circle">ä¹‹åçš„å˜åŒ–äº‹ä»¶ä»ç„¶ä¼šè¿›å…¥åˆ°è®°å½•é˜Ÿåˆ—ä¸­ï¼Œè¿™å°±æ˜¯ä¸<code>disconnect()</code> çš„ä¸»è¦åŒºåˆ«</li></ul><pre id="0a338984-2144-4db0-8d0b-87fc8782518c" class="code code-wrap"><code>const div = document.querySelector(&quot;div&quot;);

const observer = new MutationObserver((mutationRecords) =&gt;
  console.log(mutationRecords)
);

observer.observe(div, { attributes: true });

div.className = &quot;bar&quot;;
div.className = &quot;baz&quot;;
div.className = &quot;foo&quot;;

console.log(observer.takeRecords()); // [MutationRecord, MutationRecord, MutationRecord]
console.log(observer.takeRecords()); // []

div.className = &quot;foo&quot;;
// å¼‚æ­¥æ‰“å°
// [MutationRecord]</code></pre></li></ul><h1 id="f0537b46-64b2-48fb-8fc3-c0b284eaa769" class="">3.4 æ€§èƒ½ã€å†…å­˜ä¸åƒåœ¾å›æ”¶ï¼ˆ<strong>Performance, Memory, and Garbage Collection</strong>ï¼‰</h1><ul id="fc3fbb70-d908-4257-a2b7-bec3de690a0b" class="bulleted-list"><li style="list-style-type:disc">DOM Level 2 è§„èŒƒä¸­æè¿°çš„<code>MutationEvent</code> å®šä¹‰äº†ä¸€ç»„ä¼šåœ¨å„ç§DOMå˜åŒ–æ—¶è§¦å‘çš„äº‹ä»¶ï¼Œç”±äºæµè§ˆå™¨äº‹ä»¶çš„å®ç°æœºåˆ¶ï¼Œè¿™ä¸ªæ¥å£å‡ºç°äº†ä¸¥é‡çš„<strong>æ€§èƒ½</strong>é—®é¢˜</li></ul><ul id="7e7f3c80-92e5-4b31-b5d4-efb661252865" class="bulleted-list"><li style="list-style-type:disc">å› æ­¤DOM Level 3 è§„å®šåºŸå¼ƒäº†è¿™äº›äº‹ä»¶ï¼Œæå‡ºäº†<code>MutationObserver</code> æ¥å£ç”¨äºæ›¿ä»£ï¼ŒæŠŠDOMå˜åŒ–çš„è§‚å¯Ÿè®¾è®¡çš„æ›´å®ç”¨ã€æ€§èƒ½æ›´å¥½</li></ul><ul id="49c802af-4736-447e-a232-9b98636a7197" class="bulleted-list"><li style="list-style-type:disc">æ— è®ºå¦‚ä½•ï¼Œä½¿ç”¨<code>MutationObserver</code>ä»ç„¶<strong>ä¸æ˜¯æ²¡æœ‰ä»£ä»·</strong>çš„ï¼Œå› æ­¤ç†è§£ä»€ä¹ˆæ—¶å€™é¿å…å‡ºç°è¿™ç§æƒ…å†µå¾ˆé‡è¦</li></ul><h2 id="522d2610-5c0f-4a6b-809b-dd79f95af982" class="">3.4.1 MutationObserverçš„å¼•ç”¨ï¼ˆ<strong>References</strong>ï¼‰</h2><ul id="e7a017c0-52e4-45b0-9025-8cb137f9d243" class="bulleted-list"><li style="list-style-type:disc">åœ¨<a href="../6%20%E9%9B%86%E5%90%88%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/5%20WeakMap.html"><span class="icon">ğŸ›»</span>5. WeakMap</a> ä¸­ï¼Œæåˆ°è¿‡å¼±å¼•ç”¨çš„æ¦‚å¿µï¼Œå¼±å¼•ç”¨çš„é”®å€¼ä¼šè¢«åƒåœ¾å›æ”¶ç¨‹åºå›æ”¶ï¼Œåœ¨<code>MutationObserver</code> æ¥å£ä¸­åŒæ ·æœ‰å¼±å¼•ç”¨çš„å®ç°<ul id="ac2be06d-d4cf-42f3-b4e5-3ad4b6bff166" class="bulleted-list"><li style="list-style-type:circle"><code>MutationObserver</code> å®ä¾‹ä¸ç›®æ ‡èŠ‚ç‚¹ä¹‹é—´çš„å¼•ç”¨å…³ç³»æ˜¯<strong>éå¯¹ç§°çš„ï¼ˆasymmetricï¼‰</strong></li></ul><ul id="c08c0f7d-06d9-4628-9a55-d6f98e3e99f5" class="bulleted-list"><li style="list-style-type:circle">éå¯¹ç§°æŒ‡è§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿçš„ç›®æ ‡èŠ‚ç‚¹ä¹‹é—´äº’ç›¸å¼•ç”¨ï¼Œä½†æ˜¯å¼•ç”¨ç±»å‹ä¸åŒ</li></ul><ul id="88870729-29a5-4d9a-9027-4b054ceb5574" class="bulleted-list"><li style="list-style-type:circle"><code>MutationObserver</code> å®ä¾‹å¯¹è¦è§‚å¯Ÿçš„ç›®æ ‡èŠ‚ç‚¹æ˜¯<strong>å¼±å¼•ç”¨ï¼Œ</strong>æ‰€ä»¥<strong>ä¸ä¼šå¦¨ç¢</strong>åƒåœ¾å›æ”¶ç¨‹åºå›æ”¶ç›®æ ‡èŠ‚ç‚¹ï¼ˆ<del>ä¹Ÿè®¸æ˜¯åœ¨DOMæ ‘ä¸­è¢«åˆ é™¤èŠ‚ç‚¹ä¾ç„¶èƒ½è§¦å‘å˜åŒ–çš„åŸå› </del>ï¼‰</li></ul><ul id="fca00ceb-f7e4-41f4-b9ad-c81330b51b29" class="bulleted-list"><li style="list-style-type:circle">ç›®æ ‡èŠ‚ç‚¹å¯¹<code>MutationObserver</code> å®ä¾‹æ˜¯<strong>å¼ºå¼•ç”¨ï¼Œ</strong>æ‰€ä»¥ç­‰æ³¨å†Œçš„æ‰€æœ‰ç›®æ ‡èŠ‚ç‚¹ä»DOMä¸­è¢«ç§»é™¤ï¼Œéšåè¢«åƒåœ¾å›æ”¶åï¼Œå…³è”çš„<code>MutationObserver</code> æ‰ä¼šè¢«åƒåœ¾å›æ”¶</li></ul></li></ul><h2 id="90724117-f837-4e64-9259-8fbc3842df12" class="">3.4.2 MutationRecordçš„å¼•ç”¨ï¼ˆ<strong>References</strong>ï¼‰</h2><ul id="f7e14f3f-a36e-4b2d-a877-ca1d1341a56b" class="bulleted-list"><li style="list-style-type:disc">è®°å½•é˜Ÿåˆ—ä¸­çš„æ¯ä¸ª<code>MutationRecord</code> å®ä¾‹è‡³å°‘åŒ…å«å¯¹å·²æœ‰DOMèŠ‚ç‚¹çš„ä¸€ä¸ªå¼•ç”¨ï¼ˆ<code>target</code> å±æ€§ï¼‰ï¼Œå¦‚æœå˜åŒ–æ˜¯<code>childList</code>ç±»å‹ï¼Œåˆ™ä¼šåŒ…å«å¤šä¸ªèŠ‚ç‚¹çš„å¼•ç”¨</li></ul><ul id="1f96baa7-43c8-40b4-a9b7-58a7e2c7e2eb" class="bulleted-list"><li style="list-style-type:disc">è®°å½•é˜Ÿåˆ—å’Œå›è°ƒå¤„ç†çš„é»˜è®¤è¡Œä¸ºæ˜¯<strong>è€—å°½</strong>è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¤„ç†æ¯ä¸ª<code>MutationRecord</code> ï¼Œç„¶åè®©å®ƒä»¬è¶…å‡ºä½œç”¨åŸŸå¹¶è¢«åƒåœ¾å›æ”¶<ul id="6f6ccf0d-6e0f-4586-af1a-e96ca9adc978" class="bulleted-list"><li style="list-style-type:circle">å¼‚æ­¥è°ƒç”¨ä¸€æ¬¡å›è°ƒï¼Œå°±ä¼šæ¶ˆè€—è®°å½•é˜Ÿåˆ—ä¸­çš„<code>MutationRecord</code> å®ä¾‹</li></ul><ul id="9f4d4ec3-da90-466f-9074-15a3447ca744" class="bulleted-list"><li style="list-style-type:circle">å¦‚æœéœ€è¦ä¿å­˜æŸä¸ªè§‚å¯Ÿè€…çš„å®Œæ•´å˜åŒ–è®°å½•ï¼Œ<strong>ä¸èƒ½ç›´æ¥ä¿å­˜</strong><code>MutationRecord</code> å®ä¾‹ï¼Œå› ä¸ºå®ƒä»¬å¼•ç”¨ç€èŠ‚ç‚¹ï¼Œä¼šå¦¨ç¢è¿™äº›èŠ‚ç‚¹è¢«å›æ”¶ï¼Œå¦‚æœéœ€è¦å°½å¿«é‡Šæ”¾å†…å­˜ï¼Œå¯ä»¥ä»<code>MutationRecord</code> ä¸­æŠ½å–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ä¸Šï¼Œæœ€åæŠ›å¼ƒ<code>MutationRecord</code></li></ul></li></ul><p id="ffdd11e8-d321-400f-8544-f96271ae7d5d" class="">
</p><p id="8cd969d8-e557-4be3-bfb1-8afc74fc928a" class="">
</p><p id="f800671a-8b59-492a-b0b2-152752342c4e" class="">
</p></div></div><p id="e76064e7-87a7-4a89-a001-e3d450d6b053" class="">
</p></div></article></body></html>